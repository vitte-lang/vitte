// vittec src ULTRA MAX skeleton
# =========================================================
# vittec — Bench / Module
# =========================================================

space vittec/benches

share all

<<< doc
Module racine des benchmarks du compilateur vittec.

Ce module sert de façade unique pour toutes les suites
de benchmarks disponibles dans l’outil.

Rôle :
- point d’entrée stable pour les benches
- agrégation des benchmarks individuels
- aucun code de mesure ici
- aucune dépendance backend directe

Usage :
    vittec bench
    vittec bench compile
>>>

# ---------------------------------------------------------
# Sous-modules de benchmarks
# ---------------------------------------------------------

pull vittec/benches/compile as compile

# ---------------------------------------------------------
# Type générique de bench
# ---------------------------------------------------------

pick BenchKind
    case Compile
.end

# ---------------------------------------------------------
# Configuration globale bench
# ---------------------------------------------------------

form BenchOptions
    field kind as Option[BenchKind]
    field iterations as Option[u32]
    field warmup as Option[u32]
.end

# ---------------------------------------------------------
# Résultat générique bench
# ---------------------------------------------------------

form BenchReport
    field name as string
    field summary as string
.end

# ---------------------------------------------------------
# Dispatcher principal
# ---------------------------------------------------------

proc run_bench(options as BenchOptions)

    select options.kind
        when some(Compile)
            emit compile.main(options)
    otherwise
        emit run_all(options)
    .end
.end

# ---------------------------------------------------------
# Exécution de tous les benchmarks
# ---------------------------------------------------------

proc run_all(options as BenchOptions)

    emit "Running all vittec benchmarks"
    emit compile.main(options)

.end

# ---------------------------------------------------------
# Point d’entrée CLI benches
# ---------------------------------------------------------

entry benches at vittec/benches

    # options par défaut
    make opts as BenchOptions =
        BenchOptions(
            none,
            none,
            none
        )

    emit run_bench(opts)

.end