# ============================================================
# vittec — cli/mod.vit
# Compiler CLI Root (vittec) — ULTRA MAX
# ============================================================

space vittec/cli

# ----------------------------
# Imports
# ----------------------------

pull vittec/cli/args
pull vittec/cli/commands
pull vittec/cli/config
pull vittec/cli/version
pull vitte/ast_ir/program
pull vitte/collections/map
pull vitte/collections/list

# ----------------------------
# Public API
# ----------------------------

share all

# ----------------------------
# CLI Context
# ----------------------------

type CliContext
    args        : CliArgs
    config      : CliConfig
    program     : ProgramBundle
.end

# ----------------------------
# Constructors
# ----------------------------

proc CliContext.new(args: CliArgs, config: CliConfig) -> CliContext
    return CliContext {
        args    = args,
        config  = config,
        program = ProgramBundle.new()
    }
.end

# ----------------------------
# Dispatch
# ----------------------------

proc dispatch(ctx: CliContext) -> int
    match ctx.args.command
        "build"   => return commands.build(ctx)
        "check"   => return commands.check(ctx)
        "run"     => return commands.run(ctx)
        "fmt"     => return commands.fmt(ctx)
        "version" => return version.print()
        _          => return commands.help()
    .end
.end

# ----------------------------
# Entry point
# ----------------------------

proc main(argv: List[String]) -> int
    let args   = args.parse(argv)
    let config = config.load(args)
    let ctx    = CliContext.new(args, config)

    return dispatch(ctx)
.end

# ----------------------------
# End of module
# ----------------------------
