# toolchain/config/hardening.toml
#
# Vitte toolchain â€“ security hardening profile (compile + link policy).
#
# This profile is meant to be merged on top of default.toml + target preset.
# It stays declarative; actual flag mapping is handled by your clang_flags/clang.h layer.
#
# Recommended usage:
#   vitte build --profile hardening
#
# Notes:
#  - Some flags are platform-dependent (Darwin vs ELF vs COFF).
#  - Sanitizers are not enabled here by default (use a separate asan/ubsan profile).

[version]
schema = 1

[profile]
name = "hardening"

[compile]
# Strong warnings + treat as errors (override if too strict).
warnings = "strict"
werror   = true

# Stack protection (clang: -fstack-protector-strong / -fstack-protector-all)
stack_protector = "strong"   # none|basic|strong|all

# Fortify (glibc/clang): -D_FORTIFY_SOURCE=2 (requires -O1+)
fortify = 2

# Safer codegen knobs (where supported)
cf_protection = "none"       # none|branch|full (mainly x86_64 Linux with CET)
omit_frame_pointer = false

# UB / overflow behavior (policy)
trap_on_overflow = false     # if true: -ftrapv (can be expensive)

# Visibility hardening for libraries (optional)
default_visibility = "hidden" # default|hidden

# Defines common for hardening
defines = [
  "_FORTIFY_SOURCE=2",
  "VITTE_HARDENING=1",
]

[link]
# PIE (ELF) / ASLR-friendly. On macOS this is generally default; on Windows not applicable.
pie = true

# RELRO + NOW (ELF). Darwin uses different linker options; leave as policy keywords.
relro = "full"     # none|partial|full
bind_now = true    # -Wl,-z,now

# No executable stack (ELF). Policy only.
no_exec_stack = true

# Strip (optional). Keep false for debugability; enable in release-dist profile instead.
strip = false

# Extra raw args (optional; platform-specific)
args = [
  # Linux (ELF):
  # "-Wl,-z,relro",
  # "-Wl,-z,now",
  # "-Wl,-z,noexecstack",

  # macOS:
  # "-Wl,-dead_strip",

  # Windows: generally ignored for these concepts.
]

[libraries]
lib_dirs = [
]
libs = [
]

[archive]
deterministic = true
run_ranlib    = false
