# toolchain/config/sanitizers.toml
#
# Vitte toolchain â€“ sanitizer profile (ASan/UBSan/TSan/LSan/MSan) for Clang.
#
# Merge this profile on top of default.toml + target preset.
#
# Notes:
#  - Sanitizers are not universally supported on all targets (e.g., MSan requires
#    instrumented libc; TSan limited on some platforms; Windows support differs).
#  - You usually want: opt=O1, debug=g2, no-omit-frame-pointer.
#  - Mixing sanitizers can be invalid (e.g., TSan with ASan).
#
# Policy model:
#  - Enable one primary sanitizer set via [sanitizers].kind
#  - Extra flags are emitted by your clang flag mapping layer.

[version]
schema = 1

[profile]
name = "sanitizers"

[compile]
opt   = "O1"
debug = "g2"

warnings = "default"
werror   = false

# Required for good stack traces
omit_frame_pointer = false

# Often recommended to keep instrumentation stable
pic = true

defines = [
  "VITTE_SANITIZERS=1",
]

[sanitizers]
# One of: "asan", "ubsan", "tsan", "msan", "lsan", "asan+ubsan", "none"
kind = "asan+ubsan"

# Common knobs
recover = false          # -fno-sanitize-recover=all if false
halt_on_error = true     # ASAN_OPTIONS=halt_on_error=1 (runtime env hint)
detect_leaks  = true     # enable LeakSanitizer when available

# UBSan specifics
undefined_trap = false   # -fsanitize-undefined-trap-on-error

# ASan specifics
use_after_return = false # ASAN_OPTIONS=detect_stack_use_after_return=1 (runtime env hint)

# TSan specifics
suppressions = ""        # path to suppressions file (runtime env hint)

# MSan specifics (requires instrumented libraries; usually Linux)
track_origins = 1        # 0/1/2 (runtime env hint)

[link]
use_lld = true
# Sanitizer runtime libs are injected by clang driver, but some platforms need extra.
args = [
  # Example for Linux if needed:
  # "-pthread",
]

[env]
# Runtime environment hints (not automatically applied unless your runner uses them).
# Keys/values should be applied when launching instrumented binaries.
ASAN_OPTIONS = "abort_on_error=1:halt_on_error=1:detect_leaks=1"
UBSAN_OPTIONS = "print_stacktrace=1"
TSAN_OPTIONS = "halt_on_error=1"
MSAN_OPTIONS = "halt_on_error=1:track_origins=1"
LSAN_OPTIONS = "verbosity=0"
