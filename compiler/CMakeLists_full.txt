cmake_minimum_required(VERSION 3.16)

project(vittec VERSION 0.1.0 LANGUAGES C)

# Set C standard
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_C_EXTENSIONS OFF)

# Include directories
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)

# Compiler source files
set(VITTEC_SOURCES
    src/main.c
    src/vittec.c
    src/version.c
    src/compiler.c
    src/ast.c
    src/parser.c
    src/lexer.c
    src/types.c
    src/hir.c
    src/ir.c
    src/sema.c
    src/symbol_table.c
    src/diagnostic.c
    src/backend_c.c
    src/backend.c
    src/frontend.c
    src/codegen.c
    src/lowering.c
    src/optimizer.c
    src/target.c
    src/driver.c
)

# Bootstrap compiler sources
set(BOOTSTRAP_SOURCES
    src/front/lexer.c
    src/front/parser.c
    src/diag/diagnostic.c
    src/diag/emitter_human.c
    src/diag/emitter_json.c
    src/diag/source_map.c
    src/back/emit_c.c
    src/support/arena.c
    src/support/fs.c
    src/support/log.c
    src/support/str.c
    src/support/vec.c
)

# Create main vittec executable
add_executable(vittec ${VITTEC_SOURCES} ${BOOTSTRAP_SOURCES})

# Compiler flags
if(MSVC)
    target_compile_options(vittec PRIVATE /W4 /WX)
else()
    target_compile_options(vittec PRIVATE -Wall -Wextra -Werror)
endif()

# Debug/Release specific flags
if(CMAKE_BUILD_TYPE MATCHES Debug)
    target_compile_options(vittec PRIVATE -g -O0 -DDEBUG)
elseif(CMAKE_BUILD_TYPE MATCHES Release)
    target_compile_options(vittec PRIVATE -O2 -DNDEBUG)
endif()

# Installation
install(TARGETS vittec
    RUNTIME DESTINATION bin
)

install(DIRECTORY include/ DESTINATION include)

# Testing (optional)
enable_testing()

# Add test targets here when ready
# add_subdirectory(tests)
