# ============================================================
# vitte_mir_build::mir::value
# Valeurs MIR (ValueId, Value)
# ============================================================

space vitte/compiler/backends/vitte_mir_build/mir


# ------------------------------------------------------------
# Identifiant de valeur
# ------------------------------------------------------------

type ValueId = u32


# ------------------------------------------------------------
# Type MIR (léger, optionnel)
# ------------------------------------------------------------

# Représentation volontairement minimale.
# Le typage précis peut être porté par HIR/SSA ultérieurement.
pick MirType
    case Unknown
    case Bool
    case I8
    case I16
    case I32
    case I64
    case U8
    case U16
    case U32
    case U64
    case F32
    case F64
    case Ptr
.end


# ------------------------------------------------------------
# Métadonnées de debug (optionnelles)
# ------------------------------------------------------------

form DebugInfo
    name: Option[string]
    line: Option[u32]
    column: Option[u32]
.end


proc DebugInfo::none
-> DebugInfo

    give DebugInfo {
        name = None
        line = None
        column = None
    }
.end


# ------------------------------------------------------------
# Valeur MIR
# ------------------------------------------------------------

form Value
    id: ValueId
    ty: MirType
    debug: DebugInfo
.end


# ------------------------------------------------------------
# Constructeurs
# ------------------------------------------------------------

proc Value::new
    id: ValueId
-> Value

    give Value {
        id = id
        ty = MirType::Unknown
        debug = DebugInfo::none()
    }
.end


proc Value::with_type
    id: ValueId
    ty: MirType
-> Value

    give Value {
        id = id
        ty = ty
        debug = DebugInfo::none()
    }
.end


proc Value::with_debug
    id: ValueId
    ty: MirType
    dbg: DebugInfo
-> Value

    give Value {
        id = id
        ty = ty
        debug = dbg
    }
.end
