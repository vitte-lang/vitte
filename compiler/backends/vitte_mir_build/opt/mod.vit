# ============================================================
# vitte_mir_build::opt
# Module racine des optimisations MIR
# ============================================================

space vitte/compiler/backends/vitte_mir_build/opt


# ------------------------------------------------------------
# Sous-modules d’optimisation
# ------------------------------------------------------------

# Dead Code Elimination
pull vitte/compiler/backends/vitte_mir_build/opt/dce

# Simplifications structurelles
pull vitte/compiler/backends/vitte_mir_build/opt/simplify


# ------------------------------------------------------------
# Re-exports publics
# ------------------------------------------------------------

use dce::run_dce
use simplify::run_simplify


# ------------------------------------------------------------
# Orchestration simple des passes
# ------------------------------------------------------------

form OptPipeline
    enable_simplify: bool
    enable_dce: bool
.end


proc OptPipeline::default
-> OptPipeline

    give OptPipeline {
        enable_simplify = true
        enable_dce = true
    }
.end


# ------------------------------------------------------------
# Exécution du pipeline d’optimisation
# ------------------------------------------------------------

proc run_opt_pipeline
    func: &mut vitte/compiler/backends/vitte_mir_build/mir::Function
    pipe: OptPipeline
-> void

    if pipe.enable_simplify
        run_simplify(func)
    .end

    if pipe.enable_dce
        run_dce(func)
    .end
.end
