name: "Bug report"
description: "Report a reproducible bug in Vitte (compiler, runtime, stdlib, Muffin)"
title: "[Bug]: "
labels:
  - bug
  - needs-triage
body:
  - type: markdown
    attributes:
      value: |
        Thanks for taking the time to report a bug.

        Before submitting:
        - Search existing issues (including closed).
        - Prefer a minimal reproduction (one file or one command).
        - If you built from source, include the exact commit SHA.

        ---

        **Security note**: If this is a security issue, do **not** file a public bug. Use the security contact process instead.

  - type: checkboxes
    id: preflight
    attributes:
      label: "Pre-flight checks"
      description: "Confirm the following before we triage."
      options:
        - label: "I searched existing issues and did not find a duplicate."
          required: true
        - label: "I can reproduce this issue on the latest commit (or I specify the exact version below)."
          required: true
        - label: "I am providing enough detail for someone else to reproduce (logs / steps / repro)."
          required: true

  - type: dropdown
    id: component
    attributes:
      label: "Component"
      description: "Where does the bug happen?"
      options:
        - "compiler: lexer"
        - "compiler: parser (core)"
        - "compiler: parser (phrase/desugar)"
        - "compiler: AST"
        - "compiler: sema/typecheck"
        - "compiler: lower/IR"
        - "compiler: codegen"
        - "compiler: diagnostics"
        - "compiler: CLI (vittec)"
        - "muffin (manifest/resolver)"
        - "runtime: VM/bytecode"
        - "runtime: GC/alloc"
        - "runtime: FFI/ABI"
        - "stdlib"
        - "bench"
        - "docs/spec"
        - "other"
    validations:
      required: true

  - type: dropdown
    id: severity
    attributes:
      label: "Severity"
      description: "Impact classification."
      options:
        - "crash / assertion / abort"
        - "hang / deadlock"
        - "wrong output / miscompile"
        - "diagnostics incorrect / misleading"
        - "performance regression"
        - "build / install failure"
        - "other"
    validations:
      required: true

  - type: dropdown
    id: reproducibility
    attributes:
      label: "Reproducibility"
      description: "How often does it reproduce?"
      options:
        - "always"
        - "often"
        - "sometimes"
        - "rare"
        - "only once"
    validations:
      required: true

  - type: dropdown
    id: host_os
    attributes:
      label: "Host OS"
      description: "Operating system where you run the compiler/tools."
      options:
        - "Linux"
        - "macOS"
        - "Windows"
        - "FreeBSD"
        - "NetBSD"
        - "OpenBSD"
        - "DragonFly BSD"
        - "Solaris / illumos"
        - "Other (specify below)"
    validations:
      required: true

  - type: input
    id: host_os_version
    attributes:
      label: "Host OS version"
      description: "Example: Ubuntu 24.04, macOS 15.2, Windows 11 23H2, FreeBSD 14.1, OmniOS r151050."
      placeholder: "e.g. Ubuntu 24.04"
    validations:
      required: true

  - type: input
    id: host_arch
    attributes:
      label: "Host architecture"
      description: "CPU architecture for the machine running the toolchain."
      placeholder: "e.g. x86_64, aarch64"
    validations:
      required: true

  - type: input
    id: target_triple
    attributes:
      label: "Target triple"
      description: "If relevant (cross-compile), specify the target. Otherwise repeat host triple."
      placeholder: "e.g. x86_64-unknown-linux-gnu"
    validations:
      required: false

  - type: input
    id: vitte_version
    attributes:
      label: "Vitte version / commit"
      description: "Tag (e.g. v0.3.0) or full commit SHA from `git rev-parse HEAD`."
      placeholder: "e.g. v0.3.0 or 0123abcd..."
    validations:
      required: true

  - type: input
    id: muffin_version
    attributes:
      label: "Muffin version / commit"
      description: "If Muffin is separate, provide its version/commit. Otherwise write 'bundled'."
      placeholder: "e.g. bundled"
    validations:
      required: true

  - type: input
    id: toolchain
    attributes:
      label: "C toolchain"
      description: "Compiler used to build Vitte (host toolchain)."
      placeholder: "e.g. clang 18.1.8, gcc 14.2, MSVC 19.4x"
    validations:
      required: false

  - type: dropdown
    id: build_profile
    attributes:
      label: "Build profile"
      description: "How was the compiler/runtime built?"
      options:
        - "release"
        - "debug"
        - "asan"
        - "ubsan"
        - "tsan"
        - "valgrind"
        - "other (describe below)"
    validations:
      required: true

  - type: textarea
    id: summary
    attributes:
      label: "What happened"
      description: "Concise description of the observed behavior."
      placeholder: "Describe the failure mode, error message, or incorrect output."
    validations:
      required: true

  - type: textarea
    id: expected
    attributes:
      label: "What you expected"
      description: "Concise description of expected behavior."
      placeholder: "What should have happened instead?"
    validations:
      required: true

  - type: textarea
    id: repro_steps
    attributes:
      label: "Steps to reproduce"
      description: "Exact commands and inputs. Prefer copy/paste friendly steps."
      value: |
        1. …
        2. …
        3. …

        **Command(s):**
        ```sh
        # example
        vittec build
        ```
    validations:
      required: true

  - type: textarea
    id: minimal_repro
    attributes:
      label: "Minimal reproduction"
      description: |
        Provide the smallest possible code/config that reproduces.
        - Attach files if needed (zip), or paste directly.
        - If it’s a Muffin issue, include the relevant `.muf` snippet.
      placeholder: |
        ```vitte
        prog repro
          say "hello"
          ret
        .end
        ```
    validations:
      required: false

  - type: textarea
    id: logs
    attributes:
      label: "Logs / diagnostics"
      description: "Paste the full output (stderr/stdout). If large, attach a file."
      render: shell
      placeholder: |
        ```
        paste logs here
        ```
    validations:
      required: false

  - type: textarea
    id: backtrace
    attributes:
      label: "Backtrace / crash dump"
      description: "If a crash occurred, include a backtrace (lldb/gdb) and any sanitizer report."
      render: text
      placeholder: |
        ```
        (gdb) bt
        ...
        ```
    validations:
      required: false

  - type: dropdown
    id: regression
    attributes:
      label: "Regression?"
      description: "Did this work in a previous version?"
      options:
        - "unknown"
        - "no (always broken)"
        - "yes (worked before)"
    validations:
      required: true

  - type: input
    id: last_known_good
    attributes:
      label: "Last known good (if regression)"
      description: "Version/commit that worked (if you know it)."
      placeholder: "e.g. v0.2.9 or abcdef01..."
    validations:
      required: false

  - type: input
    id: first_known_bad
    attributes:
      label: "First known bad (if regression)"
      description: "Version/commit where it started failing (if you know it)."
      placeholder: "e.g. v0.3.0 or 0123abcd..."
    validations:
      required: false

  - type: checkboxes
    id: triage_helpers
    attributes:
      label: "Triage helpers"
      description: "Optional, but very useful."
      options:
        - label: "I can run a debug build and provide additional logs if requested."
          required: false
        - label: "I can try with ASan/UBSan (or I already did)."
          required: false
        - label: "I can attempt a `git bisect` and report the first bad commit."
          required: false
        - label: "I can provide a minimal patch / failing test if you point me to the right place."
          required: false

  - type: textarea
    id: extra
    attributes:
      label: "Additional context"
      description: "Anything else? Links, screenshots, environment details, constraints."
      placeholder: "Add any other relevant information here."
    validations:
      required: false

  - type: checkboxes
    id: coc
    attributes:
      label: "Code of Conduct"
      options:
        - label: "I agree to follow this project's Code of Conduct."
          required: true
