

# /Users/vincent/Documents/Github/vitte/compiler/vitte_arena/Vitte.toml
# Vitte manifest (TOML) — Arena allocator / bump allocator utilities — repo: vitte-lang/vitte

format_version = 1

[package]
name        = "vitte-arena"
version     = "0.1.0"
edition     = "2025"
description = "Arena / bump allocator utilities for Vitte compiler/runtime (fast region allocation, typed arenas, pools)."
license     = "MIT OR Apache-2.0"
authors     = ["Vincent <vincent@local>"]
readme      = "README.md"
repository  = "https://github.com/vitte-lang/vitte"
homepage    = "https://github.com/vitte-lang/vitte"
keywords    = ["vitte", "arena", "allocator", "bump", "compiler"]
categories  = ["memory-management", "development-tools"]
publish     = false

[package.metadata]
issues            = "https://github.com/vitte-lang/vitte/issues"
min_steel_version = "0.1.0"
api_stability     = "unstable"
doc_langs         = ["fr", "en"]

[layout]
root_dir     = "."
src_dir      = "src"
tests_dir    = "tests"
benches_dir  = "bench"
examples_dir = "examples"
assets_dir   = "assets"
out_dir      = "target"
cache_dir    = ".vitte"
include_dir  = "include"

[entrypoints]
lib_module = "vitte/arena"

[targets]

  [targets.lib]
  kind        = "lib"
  name        = "vitte_arena"
  crate_type  = ["rlib"]
  path        = "src/lib.vitte"
  module_root = "vitte/arena"

  [targets.tests]
  kind = "test"
  name = "vitte-arena-tests"
  path = "tests/main.vitte"

  [targets.bench]
  kind = "bench"
  name = "vitte-arena-bench"
  path = "bench/main.vitte"

[dependencies]
# Arena doit rester légère. Dépendre du core (types, alloc API, asserts) suffit souvent.
vitte-core = { path = "../../core", version = "0.1.0" }

# Optionnel: si tu veux brancher sur le runtime/GC pour debug/telemetry.
vitte-runtime = { path = "../../runtime", version = "0.1.0", optional = true }

[dev-dependencies]
vitte-testkit = { path = "../testkit", version = "0.1.0", optional = true }

[features]
# minimal, sans runtime.
default = ["bump"]

# Bump allocator (linear, reset)
bump = []

# Typed arenas (arena<T>)
typed = []

# Pools/free-lists pour objets réutilisables
pool = []

# Intégration runtime (stats/telemetry)
runtime = ["vitte-runtime"]

# Guard pages / redzones / poison en debug
sanitize = []

# Traces allocations
trace = []

[profiles]

  [profiles.dev]
  opt_level       = 0
  debug           = true
  debug_symbols   = true
  lto             = false
  codegen_units   = 16
  overflow_checks = true
  incremental     = true
  panic           = "unwind"
  strip           = "none"

  [profiles.release]
  opt_level       = 3
  debug           = false
  debug_symbols   = false
  lto             = "thin"
  codegen_units   = 1
  overflow_checks = false
  incremental     = false
  panic           = "abort"
  strip           = "symbols"

  [profiles.test]
  inherits        = "dev"
  opt_level       = 1
  overflow_checks = true

  [profiles.bench]
  inherits        = "release"
  debug           = true
  debug_symbols   = true

[toolchain]
compiler       = "steel"
compiler_min   = "0.1.0"
runtime        = "vitte-runtime"
stdlib         = "vitte-std"

clang          = "clang"
lld            = "lld"
ar             = "llvm-ar"
strip          = "llvm-strip"

compiler_flags = ["-Wall", "-Wextra"]
linker_flags   = []

defines = {
  VITTE_ARENA_BUILD = "1"
}

[scripts]
fmt   = ["vitte", "fmt", "--workspace"]
lint  = ["vitte", "lint", "--workspace"]
build = ["vitte", "build", "--profile", "dev", "-p", "vitte-arena"]
test  = ["vitte", "test", "--profile", "test", "-p", "vitte-arena"]
bench = ["vitte", "bench", "--profile", "bench", "-p", "vitte-arena"]