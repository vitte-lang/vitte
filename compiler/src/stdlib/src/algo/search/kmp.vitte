mod algo.search.kmp

fn kmp_build_lps(pat: str) -> [i64]
  let lps: [i64] = [0; pat.len]
  let len: i64 = 0
  let i: i64 = 1
  loop
    if i >= pat.len
      ret lps
    .end
    if pat[i] == pat[len]
      set len = len + 1
      set lps[i] = len
      set i = i + 1
    elif len != 0
      set len = lps[len - 1]
    else
      set lps[i] = 0
      set i = i + 1
    .end
  .end
.end

fn kmp_search(text: str, pat: str) -> i64
  if pat.len == 0
    ret 0
  .end
  let lps: [i64] = kmp_build_lps(pat)
  let i: i64 = 0
  let j: i64 = 0
  loop
    if i >= text.len
      ret -1
    .end
    if text[i] == pat[j]
      set i = i + 1
      set j = j + 1
      if j == pat.len
        ret i - j
      .end
    elif j != 0
      set j = lps[j - 1]
    else
      set i = i + 1
    .end
  .end
.end
