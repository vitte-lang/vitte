space vitte/runtime/std/alloc/alloctests/tests/utils

# ============================================================
# Assertion utilities for allocator tests
# - Lightweight, dependency-free
# - Designed for test + bench environments
# ============================================================

form AssertResult
    ok: bool
    message: string
.end

# ------------------------------------------------------------
# Core assertions
# ------------------------------------------------------------

proc assert_true(cond: bool, msg: string)
    if not cond
        panic(msg)
    .end
.end

proc assert_false(cond: bool, msg: string)
    if cond
        panic(msg)
    .end
.end

proc assert_eq[T](a: T, b: T, msg: string)
    if a != b
        panic(msg)
    .end
.end

proc assert_ne[T](a: T, b: T, msg: string)
    if a == b
        panic(msg)
    .end
.end

# ------------------------------------------------------------
# Numeric assertions
# ------------------------------------------------------------

proc assert_gt[T](a: T, b: T, msg: string)
    if not (a > b)
        panic(msg)
    .end
.end

proc assert_ge[T](a: T, b: T, msg: string)
    if not (a >= b)
        panic(msg)
    .end
.end

proc assert_lt[T](a: T, b: T, msg: string)
    if not (a < b)
        panic(msg)
    .end
.end

proc assert_le[T](a: T, b: T, msg: string)
    if not (a <= b)
        panic(msg)
    .end
.end

# ------------------------------------------------------------
# Approx / tolerance (for timings)
# ------------------------------------------------------------

proc assert_approx(val: u64, expected: u64, tolerance: u64, msg: string)
    if val + tolerance < expected or val > expected + tolerance
        panic(msg)
    .end
.end

# ------------------------------------------------------------
# Collection assertions
# ------------------------------------------------------------

proc assert_non_empty[T](xs: List of T, msg: string)
    if xs.len == 0
        panic(msg)
    .end
.end

proc assert_len[T](xs: List of T, expected: usize, msg: string)
    if xs.len != expected
        panic(msg)
    .end
.end

# ------------------------------------------------------------
# Bench-specific helpers
# ------------------------------------------------------------

proc assert_time_reasonable(ns: u64, max_ns: u64)
    if ns > max_ns
        panic("benchmark too slow")
    .end
.end

# ------------------------------------------------------------
# Test self-check
# ------------------------------------------------------------

proc test_assert_basic give bool
    assert_true(true, "true failed")
    assert_false(false, "false failed")
    assert_eq(1, 1, "eq failed")
    assert_ne(1, 2, "ne failed")
    give true
.end
