# =========================================================
# Vitte 1.0 — AST / Item
# =========================================================

space vitte/ast/item

share all

<<< doc
Ce module définit la représentation AST des items top-level
du langage Vitte.

Un item est une déclaration au niveau module, telle que :
- procédure (proc)
- type (form / pick)
- foreign (FFI)
- entry point
- imports / exports (via items dédiés)
- commentaires attachables

Aucune logique de résolution ou de typage ici.
>>>

# ---------------------------------------------------------
# Dépendances communes
# ---------------------------------------------------------

pull vitte/ast/common/span
pull vitte/ast/common/ident
pull vitte/ast/common/path
pull vitte/ast/comment
pull vitte/ast/block
pull vitte/ast/expr
pull vitte/ast/item/foreign

# ---------------------------------------------------------
# Visibilité d’un item
# ---------------------------------------------------------

pick Visibility
    case Private
    case Public
.end

# ---------------------------------------------------------
# Attributs attachables aux items
# ---------------------------------------------------------

form ItemAttributes
    field items as List[Attribute]
.end

# ---------------------------------------------------------
# Procédure (proc)
# ---------------------------------------------------------

form ProcParam
    field name as Ident
    field ty as TypeExpr
    field span as Span
.end

form ProcSignature
    field params as List[ProcParam]
    field result as TypeExpr
.end

form ProcItem
    field name as Ident
    field visibility as Visibility
    field attrs as ItemAttributes
    field signature as ProcSignature
    field body as Block
    field span as Span
.end

# ---------------------------------------------------------
# Types top-level
# ---------------------------------------------------------

form StructField
    field name as Ident
    field ty as TypeExpr
    field span as Span
.end

form StructItem
    field name as Ident
    field visibility as Visibility
    field attrs as ItemAttributes
    field fields as List[StructField]
    field span as Span
.end

form EnumCaseField
    field name as Ident
    field ty as TypeExpr
    field span as Span
.end

form EnumCase
    field name as Ident
    field fields as List[EnumCaseField]
    field span as Span
.end

form EnumItem
    field name as Ident
    field visibility as Visibility
    field attrs as ItemAttributes
    field cases as List[EnumCase]
    field span as Span
.end

# ---------------------------------------------------------
# Entry point
# ---------------------------------------------------------

form EntryItem
    field name as Ident
    field path as Path
    field attrs as ItemAttributes
    field body as Block
    field span as Span
.end

# ---------------------------------------------------------
# Import (pull)
# ---------------------------------------------------------

form ImportItem
    field path as Path
    field alias as Option[Ident]
    field span as Span
.end

# ---------------------------------------------------------
# Export (share)
# ---------------------------------------------------------

pick ExportSpec
    case All
    case Names(names as List[Ident])
.end

form ExportItem
    field spec as ExportSpec
    field span as Span
.end

# ---------------------------------------------------------
# Commentaire top-level
# ---------------------------------------------------------

form CommentItem
    field comment as Comment
    field span as Span
.end

# ---------------------------------------------------------
# Union principale Item
# ---------------------------------------------------------

pick Item
    case Proc(item as ProcItem)
    case Struct(item as StructItem)
    case Enum(item as EnumItem)
    case Foreign(item as ForeignItem)
    case Entry(item as EntryItem)
    case Import(item as ImportItem)
    case Export(item as ExportItem)
    case Comment(item as CommentItem)
.end

# ---------------------------------------------------------
# Fichier / module AST
# ---------------------------------------------------------

form ItemList
    field items as List[Item]
.end

# ---------------------------------------------------------
# Erreurs AST liées aux items (pré-HIR)
# ---------------------------------------------------------

pick ItemError
    case DuplicateName(name as string, span as Span)
    case InvalidVisibility(span as Span)
    case InvalidEntry(span as Span)
    case ConflictingAttributes(span as Span)
.end

# ---------------------------------------------------------
# Types (référence minimale)
# ---------------------------------------------------------

pick TypeExpr
    case Simple(name as Ident)
    case Generic(name as Ident, args as List[TypeExpr])
.end