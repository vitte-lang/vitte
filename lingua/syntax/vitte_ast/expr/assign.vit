# =========================================================
# Vitte 1.0 — AST / Expr / Assign
# =========================================================

space vitte/ast/expr/assign

share all

<<< doc
Ce module définit la représentation AST des expressions
d’assignation dans le langage Vitte.

Une assignation :
- apparaît comme statement (`expr_stmt`)
- modifie une valeur existante
- n’introduit jamais de nouveau symbole (contrairement à `make`)
- est analysée syntaxiquement ici, puis validée en HIR

Syntaxe concernée (surface) :
    <expr> = <expr>

La validité du lvalue est vérifiée ultérieurement.
>>>

# ---------------------------------------------------------
# Dépendances communes
# ---------------------------------------------------------

pull vitte/ast/common/span
pull vitte/ast/common/ident

# ---------------------------------------------------------
# LValue (côté gauche d’une assignation)
# ---------------------------------------------------------

pick LValue
    case Ident(name as Ident)
    case Field(base as Expr, field as Ident)
.end

# ---------------------------------------------------------
# Assignement expression
# ---------------------------------------------------------

form AssignExpr
    field target as LValue
    field value as Expr
    field span as Span
.end

# ---------------------------------------------------------
# Assignement statement
# ---------------------------------------------------------

form AssignStmt
    field assign as AssignExpr
    field span as Span
.end

# ---------------------------------------------------------
# Référence minimale vers Expr (évite dépendance circulaire)
# ---------------------------------------------------------

pick Expr
    case Ident(name as Ident)
    case Field(base as Expr, field as Ident)
    case Call(expr as CallExpr)
    case Binary(expr as BinaryExpr)
    case Assign(expr as AssignExpr)
    case Group(expr as Expr)
.end

# ---------------------------------------------------------
# Expressions support minimales
# ---------------------------------------------------------

form CallExpr
    field callee as Expr
    field args as List[Expr]
    field span as Span
.end

form BinaryExpr
    field left as Expr
    field op as BinOp
    field right as Expr
    field span as Span
.end

pick BinOp
    case Add
    case Sub
    case Mul
    case Div
    case Eq
    case Ne
    case Lt
    case Le
    case Gt
    case Ge
    case And
    case Or
.end

# ---------------------------------------------------------
# Erreurs AST liées aux assignations
# ---------------------------------------------------------

pick AssignError
    case InvalidTarget(span as Span)      # ex: 1 = x
    case ImmutableTarget(name as string, span as Span)
.end