# =========================================================
# Vitte 1.0 — AST / Common / Ident
# =========================================================

space vitte/ast/common/ident

share all

<<< doc
Ce module définit les identifiants AST canoniques du langage Vitte.

Un identifiant :
- correspond à une occurrence syntaxique (`ident` lexical)
- porte toujours une position source (Span)
- est utilisé uniformément dans tout l’AST :
    - types
    - variables
    - champs
    - procédures
    - modules
    - patterns

Aucune résolution de nom n’est faite ici.
>>>

# ---------------------------------------------------------
# Position source (partagée)
# ---------------------------------------------------------

form Span
    field file as string
    field line_start as u32
    field line_end as u32
    field column_start as u32
    field column_end as u32
.end

# ---------------------------------------------------------
# Identifiant simple
# ---------------------------------------------------------

form Ident
    field name as string
    field span as Span
.end

# ---------------------------------------------------------
# Identifiant qualifié (ex: module/type)
# ---------------------------------------------------------

form QualifiedIdent
    field parts as List[Ident]
    field span as Span
.end

# ---------------------------------------------------------
# Catégorie d’identifiant (usage syntaxique)
# ---------------------------------------------------------

pick IdentKind
    case Value        # variable, paramètre, local
    case Type         # form, pick, bond
    case Proc         # procédure
    case Field        # champ de struct / payload
    case Module       # segment de module_path
    case Attribute    # #[ident]
    case Pattern      # binding de pattern
.end

# ---------------------------------------------------------
# Identifiant annoté (pré-HIR)
# ---------------------------------------------------------

form AnnotatedIdent
    field ident as Ident
    field kind as IdentKind
.end

# ---------------------------------------------------------
# Identifiant résolu (post-résolution, pré-typage)
# ---------------------------------------------------------

form ResolvedIdent
    field ident as Ident
    field kind as IdentKind
    field id as u32            # id interne stable
.end

# ---------------------------------------------------------
# Table d’identifiants (infrastructure)
# ---------------------------------------------------------

form IdentTable
    field items as List[ResolvedIdent]
.end

# ---------------------------------------------------------
# Erreurs liées aux identifiants
# ---------------------------------------------------------

pick IdentError
    case Undefined(name as string, span as Span)
    case Redefined(name as string, span as Span)
    case InvalidKind(name as string, expected as IdentKind, found as IdentKind, span as Span)
.end

# ---------------------------------------------------------
# Créateurs utilitaires (AST-level)
# ---------------------------------------------------------

proc make_ident(
    name as string,
    span as Span
) gives Ident

    give Ident(name, span)
.end

proc make_qualified(
    parts as List[Ident],
    span as Span
) gives QualifiedIdent

    give QualifiedIdent(parts, span)
.end

# ---------------------------------------------------------
# Comparaison syntaxique (nom uniquement)
# ---------------------------------------------------------

proc ident_eq(
    a as Ident,
    b as Ident
) gives bool

    give a.name == b.name
.end