use std/arduino/i2c.*
use std/arduino/spi.*
use std/arduino/gpio.*
use std/arduino/timer.*

entry main at core/app {
  begin()
  pin_mode(10, PinMode.Output)
  digital_write(10, PinState.High)

  loop {
    begin_transmission(0x23)
    let _ = write(0x10)
    let _ = end_transmission()
    delay_ms(180)

    let _ = request_from(0x23, 2)
    let hi = read()
    let lo = read()
    let _ = hi
    let _ = lo

    digital_write(10, PinState.Low)
    let _ = transfer(0x01)
    let _ = transfer(0x80)
    let _ = transfer(0x00)
    digital_write(10, PinState.High)

    delay_ms(500)
  }

  return 0
}
