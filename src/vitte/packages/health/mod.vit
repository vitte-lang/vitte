<<<
mod.vit
package vitte/health
>>>

space vitte/health

form HealthInput {
  db_ok: bool
  cache_ok: bool
  queue_ok: bool
  migrations_ok: bool
  warmed: bool
  started: bool
}

proc input(db_ok: bool, cache_ok: bool, queue_ok: bool, migrations_ok: bool, warmed: bool, started: bool) -> HealthInput {
  give HealthInput(db_ok, cache_ok, queue_ok, migrations_ok, warmed, started)
}

proc check_live(h: HealthInput) -> bool {
  give h.started
}

proc check_ready(h: HealthInput) -> bool {
  give h.started && h.db_ok && h.cache_ok && h.queue_ok && h.warmed
}

proc check_startup(h: HealthInput) -> bool {
  give h.started && h.migrations_ok
}

proc report_json(h: HealthInput) -> string {
  let live = "false"
  if check_live(h) { live = "true" }

  let ready = "false"
  if check_ready(h) { ready = "true" }

  let startup = "false"
  if check_startup(h) { startup = "true" }

  give "{\"live\":" + live + ",\"ready\":" + ready + ",\"startup\":" + startup + "}"
}

proc ready() -> bool {
  give true
}


<<< ROLE-CONTRACT
package: vitte/health
role: Endpoints live ready startup pour orchestration production
input_contract: Etat infra explicite (db cache queue migrations warmed started)
output_contract: Signaux sante deterministes et projection JSON stable
boundary: Ne repare pas les dependances; expose uniquement leur etat agrege
>>>
