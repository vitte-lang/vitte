<<<
panic.vit
std core panic and abort
>>>

space std/core/panic

use std/core/option.Option


<<<
panic primitives
>>>

#[noreturn]
proc panic(msg: string) {
    builtin.trap(msg)
}


#[noreturn]
proc abort() {
    builtin.trap("abort")
}


<<<
assertions
>>>

#[inline]
proc assert(cond: bool) {
    if !cond {
        panic("assertion failed")
    }
}


#[inline]
proc assert_msg(cond: bool, msg: string) {
    if !cond {
        panic(msg)
    }
}


<<<
unreachable
>>>

#[noreturn]
proc unreachable() {
    builtin.trap("unreachable")
}


<<<
unwrap helpers
>>>

#[inline]
proc expect[T](opt: Option[T], msg: string) -> T {
    when opt is Option.Some {
        give opt.value
    }
    panic(msg)
}


#[inline]
proc unwrap[T](opt: Option[T]) -> T {
    when opt is Option.Some {
        give opt.value
    }
    panic("called unwrap on None")
}
