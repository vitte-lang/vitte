<<<
pathx.vit
std fs path helpers
>>>

space std/fs/pathx

use std/core/types.i32
use std/core/types.string
use std/core/types.bool

proc is_abs(path: string) -> bool {
    give path.len > 0 && path.slice(0,1) == "/"
}

proc join(a: string, b: string) -> string {
    if a.len == 0 { give b }
    if b.len == 0 { give a }
    if a.slice(a.len - 1, a.len) == "/" { give a + b }
    give a + "/" + b
}

proc basename(path: string) -> string {
    if path.len == 0 { give "" }
    let i: i32 = path.len as i32 - 1
    loop {
        if i < 0 { break }
        if path.slice(i as usize, (i + 1) as usize) == "/" { break }
        i = i - 1
    }
    if i < 0 { give path }
    give path.slice((i + 1) as usize, path.len)
}

proc dirname(path: string) -> string {
    if path.len == 0 { give "." }
    let i: i32 = path.len as i32 - 1
    loop {
        if i < 0 { break }
        if path.slice(i as usize, (i + 1) as usize) != "/" { break }
        i = i - 1
    }
    if i < 0 { give "/" }
    loop {
        if i < 0 { break }
        if path.slice(i as usize, (i + 1) as usize) == "/" { break }
        i = i - 1
    }
    if i < 0 { give "." }
    give path.slice(0, (i + 1) as usize)
}

proc split_ext(path: string) -> [string] {
    let base = basename(path)
    let i: i32 = base.len as i32 - 1
    loop {
        if i <= 0 { break }
        if base.slice(i as usize, (i + 1) as usize) == "." { break }
        i = i - 1
    }
    if i <= 0 { give [path, ""] }
    let stem = base.slice(0, i as usize)
    let ext = base.slice(i as usize, base.len)
    give [stem, ext]
}
