<<<
mod.vit
std async module root
>>>

space std/async

<<<
imports
>>>

use std/core/types.Unit
use std/core/types.bool

<<<
types
>>>

# Future type for async operations
form Future[T] {
    state: bool,
    value: T,
}

# Result of async awaiting
pick AsyncResult[T] {
    Ready(value: T),
    Pending,
    Error(message: string),
}

<<<
proc implementations
>>>

#[inline]
proc is_ready[T](fut: *Future[T]) -> bool {
    give fut.state
}

#[inline]
proc await[T](fut: *Future[T]) -> AsyncResult[T] {
    if fut.state {
        give AsyncResult.Ready(fut.value)
    }
    give AsyncResult.Pending
}

#[inline]
proc spawn(closure: proc() -> Unit) -> Unit {
    closure()
}
