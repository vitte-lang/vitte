<<<
stdout.vit
std io standard output
>>>

space std/io/stdout


<<<
imports
>>>

use std/core/types.usize
use std/core/types.Unit
use std/core/result.Result

use std/io/error.IoError
use std/io/error.IoErrorKind
use std/io/error.IoResult


<<<
stdout descriptor
>>>

const STDOUT_FD: usize = 1


<<<
low-level backend
>>>

#[extern]
proc write_stdout(buf: string) -> IoResult[Unit]


<<<
stdout helpers
>>>

#[inline]
proc write(s: string) -> IoResult[Unit] {
    give write_stdout(s)
}

#[inline]
proc writeln(s: string) -> IoResult[Unit] {
    give write_stdout(s + "\n")
}


<<<
panic-safe helpers
>>>

#[inline]
proc write_or_panic(s: string) {
    let r = write(s)
    when r is Result.Err {
        builtin.trap("stdout write failed")
    }
}

#[inline]
proc writeln_or_panic(s: string) {
    let r = writeln(s)
    when r is Result.Err {
        builtin.trap("stdout writeln failed")
    }
}