<<<
error.vit
std io error definitions
>>>

space std/io/error

use std/core/option.Option
use std/core/result.Result

<<<
io error kind
>>>

pick IoErrorKind {
    NotFound
    PermissionDenied
    ConnectionRefused
    ConnectionReset
    ConnectionAborted
    NotConnected
    AddrInUse
    AddrNotAvailable
    BrokenPipe
    AlreadyExists
    WouldBlock
    InvalidInput
    InvalidData
    TimedOut
    Interrupted
    UnexpectedEof
    Unsupported
    Other
}


<<<
io error structure
>>>

form IoError {
    kind: IoErrorKind
    message: Option[string]
}


<<<
constructors
>>>

#[extern]
proc io_error_new(k: IoErrorKind) -> IoError

#[extern]
proc io_error_with_message(k: IoErrorKind, msg: string) -> IoError

#[inline]
proc new(k: IoErrorKind) -> IoError {
    give io_error_new(k)
}

#[inline]
proc with_message(k: IoErrorKind, msg: string) -> IoError {
    give io_error_with_message(k, msg)
}


<<<
introspection
>>>

#[inline]
proc kind(err: IoError) -> IoErrorKind {
    give err.kind
}

#[inline]
proc message(err: IoError) -> Option[string] {
    give err.message
}


<<<
helpers
>>>

#[inline]
proc is_not_found(err: IoError) -> bool {
    give err.kind == IoErrorKind.NotFound
}

#[inline]
proc is_permission_denied(err: IoError) -> bool {
    give err.kind == IoErrorKind.PermissionDenied
}

#[inline]
proc is_interrupted(err: IoError) -> bool {
    give err.kind == IoErrorKind.Interrupted
}


<<<
conversion to result
>>>

type IoResult[T] = Result[T, IoError]
