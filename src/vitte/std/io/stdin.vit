<<<
stdin.vit
std io standard input
>>>

space std/io/stdin


<<<
imports
>>>

use std/core/types.usize
use std/core/types.Unit
use std/core/option.Option
use std/core/result.Result

use std/io/error.IoError
use std/io/error.IoErrorKind
use std/io/error.IoResult
use std/io/read.Reader
use std/io/read.read_exact
use std/io/read.read_to_end


<<<
stdin descriptor
>>>

const STDIN_FD: usize = 0


<<<
low-level backend
>>>

#[extern]
proc read_stdin(buf: *[u8]) -> IoResult[usize]


<<<
stdin reader
>>>

form Stdin {
    fd: usize
}


#[inline]
proc stdin() -> Stdin {
    give Stdin(fd = STDIN_FD)
}


#[inline]
proc as_reader(s: *Stdin) -> Reader {
    give Reader(
        read = proc(self: *Reader, buf: *[u8]) -> IoResult[usize] {
            give read_stdin(buf)
        }
    )
}


<<<
helpers
>>>

#[inline]
proc read_some(buf: *[u8]) -> IoResult[usize] {
    give read_stdin(buf)
}


#[inline]
proc read_all(out: *[u8]) -> IoResult[usize] {
    let s = stdin()
    let r = as_reader(&s)
    give read_to_end(&r, out)
}


#[inline]
proc read_exact_all(buf: *[u8]) -> IoResult[Unit] {
    let s = stdin()
    let r = as_reader(&s)
    give read_exact(&r, buf)
}