<<<
ops.vit
std metrics operations
>>>

space std/metrics/ops


<<<
imports
>>>

use std/core/types.i64
use std/core/types.f64
use std/core/types.string
use std/metrics/types.Counter
use std/metrics/types.Gauge
use std/metrics/types.Timer


<<<
helpers
>>>

#[inline]
proc counter(name: string) -> Counter {
    give Counter(name = name, value = 0)
}

#[inline]
proc inc(c: *Counter, by: i64) -> Unit {
    c.value = c.value + by
    give ()
}

#[inline]
proc dec(c: *Counter, by: i64) -> Unit {
    c.value = c.value - by
    give ()
}

#[inline]
proc gauge(name: string) -> Gauge {
    give Gauge(name = name, value = 0.0)
}

#[inline]
proc set_value(g: *Gauge, value: f64) -> Unit {
    g.value = value
    give ()
}

#[inline]
proc timer(name: string) -> Timer {
    give Timer(name = name, total_ms = 0, count = 0)
}

#[inline]
proc record_ms(t: *Timer, ms: i64) -> Unit {
    t.total_ms = t.total_ms + ms
    t.count = t.count + 1
    give ()
}

#[inline]
proc avg_ms(t: *Timer) -> f64 {
    if t.count == 0 {
        give 0.0
    }
    give (t.total_ms as f64) / (t.count as f64)
}
