module compiler::backend::llvm_backend::tests;

use crate::compiler::backend::llvm_backend;
use crate::compiler::codegen::driver::session::CodegenSession;
use crate::compiler::codegen::options::codegen_options::CodegenOptions;
use crate::compiler::diagnostics::DiagSink;
use crate::compiler::ir::IrModule;

fn build_dummy_ir() -> IrModule {
    IrModule::new_for_tests()
}

#[test]
fn emit_simple_llvm_ir() {
    let mut diag = DiagSink::new();
    let ir = build_dummy_ir();
    let opts = CodegenOptions::default_c17();
    let mut session = CodegenSession::new(opts, &mut diag);
    let mut backend = llvm_backend::LlvmBackend::new(&mut session, llvm_backend::opts::options::LlvmBackendOptions::default());
    let ir_text = backend.emit_ir(&ir);
    assert!(ir_text.contains("target triple"));
}
