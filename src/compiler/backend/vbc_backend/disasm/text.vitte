module compiler::backend::vbc_backend::disasm::text;

use crate::compiler::backend::vbc_backend::decoder::model::VbcModule;
use crate::compiler::backend::vbc_backend::format::opcodes::VbcOp;

/// DÃ©sassemblage texte trÃ¨s simple.
pub fn disasm_module(m: &VbcModule) -> String {
    let mut s = String::new();
    for f in &m.functions {
        s.push_str(&format!("fn {}()\n", f.name));
        for op in &f.code {
            let line = match op {
                VbcOp::Nop => "  nop",
                VbcOp::IConst => "  iconst 42",
                VbcOp::IAdd => "  iadd",
                VbcOp::ISub => "  isub",
                VbcOp::IMul => "  imul",
                VbcOp::IDiv => "  idiv",
                VbcOp::Ret => "  ret",
            };
            s.push_str(line);
            s.push('\n');
        }
        s.push('\n');
    }
    s
}
