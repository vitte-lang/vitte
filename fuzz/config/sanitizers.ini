; fuzz/config/sanitizers.ini
; Centralized sanitizer presets for Vitte toolchain + fuzz + tests.
; Intended consumers:
; - CMake presets / toolchain wrapper
; - scripts (sh/ps1) that set CFLAGS/LDFLAGS + env
; - fuzz runner reading fuzz/config/fuzz.ini

[defaults]
; Which preset to use when none is specified
preset = asan_ubsan

; Toolchain preference (informational)
compiler = clang

; Common base flags for debug-friendly builds
base_cflags = -O1 -g -fno-omit-frame-pointer
base_ldflags =

; If 1, treat warnings as errors in sanitizer builds (recommended for CI)
werror = 0

; If 1, prefer static runtime where supported (usually 0 on Linux)
static_runtime = 0

; If 1, enable symbolization support hints (llvm-symbolizer)
symbolize = 1

[asan_ubsan]
; AddressSanitizer + UndefinedBehaviorSanitizer (general purpose)
cflags  = -fsanitize=address,undefined
ldflags = -fsanitize=address,undefined

; Runtime env
ASAN_OPTIONS  = abort_on_error=1:detect_leaks=1:symbolize=1:print_stacktrace=1
UBSAN_OPTIONS = print_stacktrace=1:halt_on_error=1

; Notes:
; - Good default for CI and local debugging.
; - LeakSanitizer is part of ASan on most platforms.

[asan_only]
cflags  = -fsanitize=address
ldflags = -fsanitize=address

ASAN_OPTIONS  = abort_on_error=1:detect_leaks=1:symbolize=1:print_stacktrace=1
UBSAN_OPTIONS =

[ubsan_only]
cflags  = -fsanitize=undefined
ldflags = -fsanitize=undefined

ASAN_OPTIONS  =
UBSAN_OPTIONS = print_stacktrace=1:halt_on_error=1

[msan]
; MemorySanitizer requires all code (including deps) built with MSan.
enabled = 0
cflags  = -fsanitize=memory
ldflags = -fsanitize=memory

MSAN_OPTIONS = halt_on_error=1:print_stacktrace=1
ASAN_OPTIONS =
UBSAN_OPTIONS =

[tsan]
; ThreadSanitizer for data races (typically not compatible with ASan).
enabled = 0
cflags  = -fsanitize=thread
ldflags = -fsanitize=thread

TSAN_OPTIONS = halt_on_error=1:second_deadlock_stack=1
ASAN_OPTIONS =
UBSAN_OPTIONS =

[coverage]
; Coverage instrumentation (gcov/llvm-cov style) for gcc/clang.
enabled = 0
cflags  = -O0 -g --coverage -fprofile-arcs -ftest-coverage -fno-inline -fno-omit-frame-pointer
ldflags = --coverage

; When combining coverage with sanitizers, prefer separate builds.

[hardened]
; Not a sanitizer, but a hardening preset (useful for release validation).
enabled = 0
cflags  = -D_FORTIFY_SOURCE=2 -fstack-protector-strong -fno-omit-frame-pointer
ldflags = -Wl,-z,relro,-z,now

[env]
; Optional: location of llvm-symbolizer if needed
LLVM_SYMBOLIZER_PATH =

; Optional: extra env appended/overriding preset values
EXTRA_ENV =
