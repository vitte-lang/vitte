; fuzz/config/fuzz.ini
; Vitte fuzz configuration (tool-agnostic).
; Conventions:
; - Paths are repository-relative.
; - Values are conservative defaults for CI + local smoke.
; - Consumers can be: tools/scripts/fuzz_*.sh/.ps1, C harness, or a fuzz runner.

[general]
; Root of the repository (optional override). Empty = auto (cwd search).
repo_root =

; Where the build system outputs binaries.
build_dir = build-fuzz

; Directory where fuzz inputs (seed corpora) live.
corpus_dir = fuzz/corpus

; Where to store crashing inputs, logs, and minimized repro cases.
artifacts_dir = fuzz/artifacts

; If 1, runner should create missing directories.
ensure_dirs = 1

; If 1, runner should fail when no fuzzers found.
require_fuzzers = 0

[fuzzers]
; Selection strategy:
; - auto: discover executables containing "fuzz" in name under build_dir
; - list: use explicit list below
mode = auto

; When mode=list, provide repo-relative paths to fuzzer binaries (one per line).
; Example:
; items =
;   build-fuzz/bin/vitte_parser_fuzz
;   build-fuzz/bin/vitte_lexer_fuzz
items =

[libfuzzer]
; Common libFuzzer options (applied when supported by the fuzzer binary).
runs = 50000
max_total_time = 60          ; seconds (0 = unlimited)
timeout = 2                  ; per-input timeout seconds (0 = default)
rss_limit_mb = 0             ; 0 = default / unlimited

; Artifact output prefix (libFuzzer flag: -artifact_prefix=)
artifact_prefix = fuzz/artifacts/

; Minimization / corpus controls (best effort).
merge = 1                    ; -merge=1
reduce_inputs = 1            ; allow minimizing crashing inputs
shuffle = 1                  ; -shuffle=1 (if supported)

; Extra args appended to every fuzzer invocation (space-separated).
extra_args =

[honggfuzz]
; If you use honggfuzz instead of libFuzzer, these are typical knobs.
enabled = 0
iterations = 0               ; 0 = unlimited
timeout = 2
threads = 0                  ; 0 = auto
extra_args =

[aflplusplus]
; AFL++ integration (if applicable).
enabled = 0
jobs = 0                     ; 0 = auto
timeout_ms = 2000
extra_args =

[sanitizers]
; Suggested sanitizer presets for CI/local.
; runner can map these to compiler/linker flags (clang) or env vars.
asan = 1
ubsan = 1
msan = 0
tsan = 0

; Runtime env overrides (empty = runner defaults).
ASAN_OPTIONS =
UBSAN_OPTIONS =
MSAN_OPTIONS =
TSAN_OPTIONS =

[coverage]
; Optional: enable generating coverage from fuzz runs (requires coverage build flags).
enabled = 0
format = lcov                ; lcov | gcovr
output_dir = fuzz/coverage

[timeouts]
; Global time budgeting for a "session" across all fuzzers.
session_max_total_time = 300 ; seconds (0 = unlimited)
per_fuzzer_max_total_time = 60

[logging]
level = info                 ; trace|debug|info|warn|error
log_file = fuzz/artifacts/fuzz.log
tee_console = 1

[ci]
; CI-friendly defaults (runner may switch based on env like CI=1).
smoke = 1
smoke_max_total_time = 20
smoke_runs = 5000
fail_on_crash = 1
upload_artifacts = 1
retain_days = 14
