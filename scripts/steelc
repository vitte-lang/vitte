#!/usr/bin/env bash
# =============================================================================
# Vitte – Wrapper steelc
#
# Point d'entrée pour :
#   make debug   -> steelc build-debug
#   make release -> steelc build-release
#
# Délègue à vittec build avec des options simples.
# =============================================================================

set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
CMD="${1:-}"

VITTEC="$ROOT/target/release/vittec"
PROJECT="$ROOT/vitte.project.muf"

if [ ! -x "$VITTEC" ]; then
  echo "[vitte][steelc][ERROR] $VITTEC introuvable ou non exécutable."
  echo "[vitte][steelc][INFO] Lance d'abord : make self-host"
  exit 1
fi

case "$CMD" in
  build-debug)
    OUT_BIN="$ROOT/target/debug/vittec"
    mkdir -p "$ROOT/target/debug"
    echo "[vitte][steelc] build-debug (copie du host bootstrap)"
    cp -f "$VITTEC" "$OUT_BIN"
    ;;

  build-release)
    OUT_BIN="$ROOT/target/release/vittec"
    mkdir -p "$ROOT/target/release"
    echo "[vitte][steelc] build-release (copie du host bootstrap)"
    if [ "$OUT_BIN" -ef "$VITTEC" ]; then
      echo "[vitte][steelc] build-release: host déjà en place (chemins identiques), rien à copier."
    else
      cp -f "$VITTEC" "$OUT_BIN"
    fi
    ;;

  *)
    echo "Usage: steelc {build-debug|build-release}"
    exit 1
    ;;
esac