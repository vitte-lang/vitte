{"version":3,"file":"completion.js","sourceRoot":"","sources":["../../src/completion.ts"],"names":[],"mappings":"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","sourcesContent":["// completion.ts — complétions LSP sans dépendance externe, robustes et contextuelles\r\n\r\nimport * as path from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport {\n  CompletionItemKind,\n  InsertTextFormat,\n  Range,\n  SymbolKind,\n  MarkupKind\n} from \"vscode-languageserver/node\";\nimport type {\n  CompletionItem,\n  Position,\n  MarkupContent\n} from \"vscode-languageserver/node\";\nimport type { TextEdit } from \"vscode-languageserver-types\";\nimport type { TextDocument } from \"vscode-languageserver-textdocument\";\nimport {\n  BOOL_LITERALS,\n  KEYWORDS,\n  NIL_LITERALS,\n  PRIMITIVE_TYPES,\n} from \"./languageFacts.js\";\nimport { searchWorkspaceSymbols, SK } from \"./indexer.js\";\n\r\n/* ============================================================================\r\n * Tables de base\r\n * ========================================================================== */\r\n\r\n// Heuristiques de membres courants, proposées après un point.\r\nconst COMMON_MEMBERS: readonly { recv: RegExp; members: string[] }[] = [\n  { recv: /(str(ing)?|text)$/i, members: [\"len\", \"is_empty()\", \"trim()\", \"to_upper()\", \"to_lower()\", \"slice(${1:start}, ${2:end})\", \"as_bytes()\"] },\n  { recv: /(vec|list|array|slice)$/i, members: [\"len\", \"is_empty()\", \"push(${1:x})\", \"pop()\", \"clear()\", \"iter()\"] },\n  { recv: /(map|dict|table)$/i, members: [\"len\", \"get(${1:key})\", \"set(${1:key}, ${2:val})\", \"remove(${1:key})\", \"keys()\", \"values()\"] }\n];\n\r\n// Idées d’imports rapides. Utiles lorsque la ligne commence par `import `.\nconst QUICK_IMPORTS: readonly string[] = [\n  \"std.core\",\n  \"std.io\",\n  \"std.net\",\n  \"std.fs\",\n  \"std.math\",\n  \"std.time\",\n  \"std.testing\",\n  \"std.os\",\n  \"std.user\"\n];\n\nconst BUILTIN_FUNCTIONS: readonly string[] = [\n  \"print\",\n  \"println\",\n  \"len\",\n  \"size\",\n  \"slice\",\n  \"as_bytes\",\n  \"push\",\n  \"pop\",\n  \"clear\",\n  \"iter\",\n  \"map\",\n  \"filter\",\n  \"reduce\",\n  \"open\",\n  \"read\",\n  \"write\",\n  \"close\",\n  \"assert\",\n  \"panic\",\n];\n\r\nconst SYMBOL_KIND_LABEL: Record<number, string> = {\r\n  [SymbolKind.File]: \"File\",\r\n  [SymbolKind.Module]: \"Module\",\r\n  [SymbolKind.Namespace]: \"Namespace\",\r\n  [SymbolKind.Package]: \"Package\",\r\n  [SymbolKind.Class]: \"Class\",\r\n  [SymbolKind.Method]: \"Method\",\r\n  [SymbolKind.Property]: \"Property\",\r\n  [SymbolKind.Field]: \"Field\",\r\n  [SymbolKind.Constructor]: \"Constructor\",\r\n  [SymbolKind.Enum]: \"Enum\",\r\n  [SymbolKind.Interface]: \"Interface\",\r\n  [SymbolKind.Function]: \"Function\",\r\n  [SymbolKind.Variable]: \"Variable\",\r\n  [SymbolKind.Constant]: \"Constant\",\r\n  [SymbolKind.String]: \"String\",\r\n  [SymbolKind.Number]: \"Number\",\r\n  [SymbolKind.Boolean]: \"Boolean\",\r\n  [SymbolKind.Array]: \"Array\",\r\n  [SymbolKind.Object]: \"Object\",\r\n  [SymbolKind.Key]: \"Key\",\r\n  [SymbolKind.Null]: \"Null\",\r\n  [SymbolKind.EnumMember]: \"EnumMember\",\r\n  [SymbolKind.Struct]: \"Struct\",\r\n  [SymbolKind.Event]: \"Event\",\r\n  [SymbolKind.Operator]: \"Operator\",\r\n  [SymbolKind.TypeParameter]: \"TypeParameter\"\r\n};\r\n\r\n/* ============================================================================\r\n * Snippets\r\n * ========================================================================== */\r\n\r\nconst SNIPPETS: CompletionItem[] = [\n  ciSnippet(\"module\", \"Déclare un module\", \"Déclare le module courant.\",\n    \"module ${1:my.module};\"),\n  ciSnippet(\"space\", \"Déclare un espace\", \"Déclare l’espace courant.\",\n    \"space ${1:std/os/user}\"),\n  ciSnippet(\"import\", \"Importe un module\", \"Importe un chemin depuis un autre module.\",\n    \"import ${1:std::core};\"),\n  ciSnippet(\"use\", \"Importe un symbole\", \"Importe un chemin depuis un module.\",\n    \"use ${1:std/core/types.i32}\"),\n  ciSnippet(\"fn\", \"Déclare une fonction\",\n    \"Fonction avec paramètres et type de retour optionnel.\",\n    \"fn ${1:name}(${2:params})${3: -> ${4:Type}} {\\n\\t$0\\n}\"),\n  ciSnippet(\"proc\", \"Déclare une procédure\",\n    \"Procédure avec paramètres et type de retour optionnel.\",\n    \"proc ${1:name}(${2:params})${3: -> ${4:Type}} {\\n\\t$0\\n}\"),\n  ciSnippet(\"docfn\", \"Doc + fonction\",\n    \"Ajoute une docstring puis une fonction.\",\n    \"/// ${1:Summary}\\n///\\n/// Params:\\n/// - ${2:param}: ${3:description}\\n/// Returns: ${4:description}\\n/// Example:\\n/// ${5:example}\\nfn ${6:name}(${7:params})${8: -> ${9:Type}} {\\n\\t$0\\n}\"),\n  ciSnippet(\"docproc\", \"Doc + procédure\",\n    \"Ajoute une docstring puis une procédure.\",\n    \"/// ${1:Summary}\\n///\\n/// Params:\\n/// - ${2:param}: ${3:description}\\n/// Returns: ${4:description}\\n/// Example:\\n/// ${5:example}\\nproc ${6:name}(${7:params})${8: -> ${9:Type}} {\\n\\t$0\\n}\"),\n  ciSnippet(\"main\", \"Point d’entrée\", \"Déclare la fonction principale.\",\n    \"fn main() {\\n\\t$0\\n}\"),\n  ciSnippet(\"struct\", \"Déclare une struct\", \"Structure avec des champs typés.\",\n    \"struct ${1:Name} {\\n\\t${2:field}: ${3:Type},\\n}\"),\n  ciSnippet(\"form\", \"Déclare un form\", \"Structure avec des champs typés.\",\n    \"form ${1:Name} {\\n\\t${2:field}: ${3:Type},\\n}\"),\n  ciSnippet(\"docstruct\", \"Doc + struct\", \"Ajoute une docstring puis une struct.\",\n    \"/// ${1:Summary}\\n///\\n/// Fields:\\n/// - ${2:field}: ${3:description}\\n/// Example:\\n/// ${4:example}\\nstruct ${5:Name} {\\n\\t${6:field}: ${7:Type},\\n}\"),\n  ciSnippet(\"docform\", \"Doc + form\", \"Ajoute une docstring puis un form.\",\n    \"/// ${1:Summary}\\n///\\n/// Fields:\\n/// - ${2:field}: ${3:description}\\n/// Example:\\n/// ${4:example}\\nform ${5:Name} {\\n\\t${6:field}: ${7:Type},\\n}\"),\n  ciSnippet(\"externproc\", \"Procédure externe\",\n    \"Déclare une procédure externe.\",\n    \"#[extern]\\nproc ${1:name}(${2:params})${3: -> ${4:Type}}\"),\n  ciSnippet(\"enum\", \"Déclare une enum\", \"Énumération avec variantes.\",\n    \"enum ${1:Name} {\\n\\t${2:Variant1},\\n\\t${3:Variant2}\\n}\"),\n  ciSnippet(\"union\", \"Déclare une union\", \"Union tagged simple.\",\n    \"union ${1:Name} {\\n\\t${2:field}: ${3:Type},\\n}\"),\n  ciSnippet(\"type\", \"Alias de type\", \"Déclare un alias de type.\",\n    \"type ${1:Alias} = ${2:Existing};\"),\n  ciSnippet(\"match\", \"Match expression\", \"Expression de branchement avec motifs.\",\n    \"match ${1:expr} {\\n\\t${2:Pattern} => ${3:expr},\\n\\t_ => ${0:default}\\n}\"),\n  ciSnippet(\"ifelse\", \"If / Else\", \"Structure conditionnelle complète.\",\n    \"if ${1:cond} {\\n\\t${2}\\n} else {\\n\\t${0}\\n}\"),\n  ciSnippet(\"for\", \"Boucle for\", \"Boucle for-in sur un itérable.\",\n    \"for ${1:pat} in ${2:iter} {\\n\\t$0\\n}\"),\n  ciSnippet(\"while\", \"Boucle while\", \"Boucle conditionnelle.\",\n    \"while ${1:cond} {\\n\\t$0\\n}\"),\n  ciSnippet(\"loop\", \"Boucle infinie\", \"Boucle sans fin, utiliser break pour sortir.\",\n    \"loop {\\n\\t$0\\n}\"),\n  ciSnippet(\"let\", \"Binding local\", \"Déclare une variable locale.\",\n    \"let ${1:name}${2: : ${3:Type}}${4: = ${5:value}};\"),\n  ciSnippet(\"const\", \"Constante\", \"Déclare une constante globale.\",\n    \"const ${1:NAME}: ${2:Type} = ${3:value};\"),\n  ciSnippet(\"static\", \"Statique\", \"Déclare un statique global.\",\n    \"static ${1:NAME}: ${2:Type} = ${3:value};\"),\n  ciSnippet(\"print\", \"Affichage console\", \"Affiche un message sur la sortie standard.\",\n    \"println(\\\"${1:msg}\\\");\"),\n  ciSnippet(\"doc\", \"Doc comment\", \"Insert a documentation comment.\",\n    \"/// ${1:Summary}\\n///\\n/// ${0:Details}\")\n];\n\r\n/* ============================================================================\r\n * Extraction symbolique simple\r\n * ========================================================================== */\r\n\r\ninterface ExtractedSym { name: string; kind: SymbolKind; }\r\n\r\nfunction extractSymbols(doc: TextDocument): ExtractedSym[] {\r\n  const text = doc.getText();\r\n  const rules: { rx: RegExp; kind: SymbolKind; g: number }[] = [\n    { rx: /^\\s*module\\s+([A-Za-z_][\\w./:]*)/gm,               kind: SymbolKind.Namespace, g: 1 },\n    { rx: /^\\s*space\\s+([A-Za-z_][\\w./:]*)/gm,                kind: SymbolKind.Namespace, g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?(?:fn|proc)\\s+([A-Za-z_]\\w*)/gm,    kind: SymbolKind.Function,  g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?struct\\s+([A-Za-z_]\\w*)/gm,         kind: SymbolKind.Struct,    g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?form\\s+([A-Za-z_]\\w*)/gm,           kind: SymbolKind.Struct,    g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?enum\\s+([A-Za-z_]\\w*)/gm,           kind: SymbolKind.Enum,      g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?union\\s+([A-Za-z_]\\w*)/gm,          kind: SymbolKind.Struct,    g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?type\\s+([A-Za-z_]\\w*)/gm,           kind: SymbolKind.Interface, g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?const\\s+([A-Za-z_]\\w*)/gm,          kind: SymbolKind.Constant,  g: 1 },\n    { rx: /^\\s*(?:pub\\s+)?static\\s+([A-Za-z_]\\w*)/gm,         kind: SymbolKind.Variable,  g: 1 },\n  ];\n\r\n  const out: ExtractedSym[] = [];\r\n  for (const { rx, kind, g } of rules) {\r\n    rx.lastIndex = 0;\r\n    let m: RegExpExecArray | null;\r\n    while ((m = rx.exec(text))) {\r\n      const name = m[g];\r\n      if (name) out.push({ name, kind });\r\n      if (m[0].length === 0) rx.lastIndex++;\r\n    }\r\n  }\r\n\r\n  const seen = new Set<string>();\r\n  return out.filter(s => {\r\n    const k = `${s.kind}:${s.name}`;\r\n    if (seen.has(k)) return false;\r\n    seen.add(k);\r\n    return true;\r\n  });\r\n}\r\n\r\nfunction mapSymbolKindToCompletionKind(k: SymbolKind): CompletionItemKind {\r\n  switch (k) {\r\n    case SymbolKind.Function:     return CompletionItemKind.Function;\r\n    case SymbolKind.Method:       return CompletionItemKind.Method;\r\n    case SymbolKind.Struct:       return CompletionItemKind.Struct;\r\n    case SymbolKind.Enum:         return CompletionItemKind.Enum;\r\n    case SymbolKind.Interface:    return CompletionItemKind.Interface;\r\n    case SymbolKind.Namespace:    return CompletionItemKind.Module;\r\n    case SymbolKind.Class:        return CompletionItemKind.Class;\r\n    case SymbolKind.Property:     return CompletionItemKind.Property;\r\n    case SymbolKind.Field:        return CompletionItemKind.Field;\r\n    case SymbolKind.Variable:     return CompletionItemKind.Variable;\r\n    case SymbolKind.Constant:     return CompletionItemKind.Constant;\r\n    case SymbolKind.Constructor:  return CompletionItemKind.Constructor;\r\n    case SymbolKind.TypeParameter:return CompletionItemKind.TypeParameter;\r\n    default:                      return CompletionItemKind.Text;\r\n  }\r\n}\r\n\r\n/* ============================================================================\r\n * Utilitaires tokenisation et score\r\n * ========================================================================== */\r\n\r\nfunction getLinePrefix(doc: TextDocument, pos: Position): string {\r\n  return doc.getText(Range.create({ line: pos.line, character: 0 }, pos));\r\n}\r\n\r\nfunction currentToken(doc: TextDocument, pos: Position): { token: string; range: Range } {\r\n  const line = doc.getText(Range.create({ line: pos.line, character: 0 }, { line: pos.line, character: 10_000 }));\r\n  const idx = Math.min(pos.character, line.length);\r\n  const left = line.slice(0, idx);\r\n  const right = line.slice(idx);\r\n\r\n  const leftMatch = /[A-Za-z_]\\w*$/.exec(left);\r\n  const rightMatch = /^\\w*/.exec(right);\r\n\r\n  const start = leftMatch ? idx - leftMatch[0].length : idx;\r\n  const end = rightMatch ? idx + rightMatch[0].length : idx;\r\n\r\n  const token = line.slice(start, end);\r\n  return {\r\n    token,\r\n    range: Range.create({ line: pos.line, character: start }, { line: pos.line, character: end })\r\n  };\r\n}\r\n\r\nfunction fuzzyScore(candidate: string, query: string): number {\r\n  if (!query) return 1;\r\n  if (candidate.startsWith(query)) return 2; // boost prefix strict\r\n  let qi = 0;\r\n  for (let i = 0; i < candidate.length && qi < query.length; i++) {\r\n    if (candidate[i].toLowerCase() === query[qi].toLowerCase()) qi++;\r\n  }\r\n  return 0.5 + qi / (2 * Math.max(1, query.length));\r\n}\r\n\r\n/* ============================================================================\r\n * Complétions contextuelles\r\n * ========================================================================== */\r\n\r\nfunction diagnosticsCompletion(linePrefix: string): CompletionItem[] {\n  const items: CompletionItem[] = [];\n  if (linePrefix.includes(\"???\")) {\n    items.push({\r\n      label: \"TODO\",\r\n      kind: CompletionItemKind.Text,\r\n      insertText: \"TODO\",\r\n      detail: \"Remplacer ??? par TODO\",\r\n      documentation: md(\"Transforme la séquence `???` en TODO/FIXME.\"),\r\n      sortText: tier(0)\r\n    });\r\n  }\r\n  if (/^\\s*import\\s+/.test(linePrefix)) {\n    for (const imp of QUICK_IMPORTS) {\r\n      items.push({\r\n        label: imp,\r\n        kind: CompletionItemKind.Module,\r\n        detail: \"Import rapide\",\r\n        documentation: md(`Ajoute l'import \\`${imp}\\`.`),\r\n        sortText: tier(0, imp)\r\n      });\r\n    }\r\n  }\r\n  return items;\r\n}\r\n\r\nfunction memberCompletion(leftOfCursor: string): CompletionItem[] {\n  const items: CompletionItem[] = [];\n  const memberCtx = /([A-Za-z_]\\w*)\\.\\s*$/.exec(leftOfCursor);\n  if (!memberCtx) return items;\n  const recv = memberCtx[1];\n\r\n  for (const group of COMMON_MEMBERS) {\r\n    if (group.recv.test(recv)) {\r\n      for (const m of group.members) {\r\n        items.push({\r\n          label: m,\r\n          kind: CompletionItemKind.Method,\r\n          detail: `Méthode de ${recv}`,\r\n          documentation: md(`Proposition basée sur le nom \\`${recv}\\`.`),\r\n          sortText: tier(0, m),\r\n          insertText: m,\r\n          insertTextFormat: /[\\$\\{]/.test(m) ? InsertTextFormat.Snippet : InsertTextFormat.PlainText\r\n        });\r\n      }\r\n    }\r\n  }\r\n  // Fallback générique\r\n  if (items.length === 0) {\r\n    for (const m of [\"len()\", \"is_empty()\", \"to_string()\", \"clone()\", \"dbg()\"]) {\r\n      items.push({\r\n        label: m,\r\n        kind: CompletionItemKind.Method,\r\n        detail: `Méthode`,\r\n        documentation: md(\"Proposition générique.\"),\r\n        sortText: tier(1, m),\r\n        insertText: m,\r\n        insertTextFormat: InsertTextFormat.PlainText\r\n      });\r\n    }\r\n  }\r\n  return items;\n}\n\nfunction workspaceSymbolCompletions(\n  doc: TextDocument,\n  token: string,\n  range: Range,\n  context: \"import\" | \"general\"\n): CompletionItem[] {\n  const normalized = token.trim();\n  if (!normalized && context === \"general\") return [];\n  const limit = context === \"import\" ? 200 : 80;\n  const results = searchWorkspaceSymbols(normalized, limit);\n  if (results.length === 0) return [];\n\n  const items: CompletionItem[] = [];\n  const seen = new Set<string>();\n\n  for (const sym of results) {\n    if (!sym?.name) continue;\n    if (sym.uri === doc.uri) continue;\n    if (context === \"general\" && fuzzyScore(sym.name, token) <= 0) continue;\n    if (context === \"import\" && !isImportableKind(sym.kind)) continue;\n\n    const key = `${sym.name}|${sym.uri}|${sym.kind}`;\n    if (seen.has(key)) continue;\n    seen.add(key);\n\n    const kind = mapSymbolKindToCompletionKind(sym.kind as unknown as SymbolKind);\n    const detailParts = [`${SYMBOL_KIND_LABEL[sym.kind] ?? \"Symbole\"}`];\n    if (sym.uri) {\n      const base = basenameFromUri(sym.uri);\n      if (base) detailParts.push(base);\n    }\n\n    items.push({\n      label: sym.name,\n      kind,\n      detail: detailParts.join(\" — \"),\n      documentation: md(`Symbole workspace \\`${sym.name}\\`.`),\n      sortText: tier(context === \"import\" ? 0 : 1, `ws:${sym.name}`),\n      filterText: sym.name,\n      textEdit: edit(range, sym.name),\n      labelDetails: context === \"import\"\n        ? { detail: \"workspace\" }\n        : { description: SYMBOL_KIND_LABEL[sym.kind] ?? \"symbol\" }\n    });\n    if (context === \"general\" && items.length >= 40) break;\n    if (context === \"import\" && items.length >= 60) break;\n  }\n\n  return items;\n}\n\nfunction isImportableKind(kind: SK): boolean {\n  return kind === SK.Module || kind === SK.Namespace;\n}\n\nfunction basenameFromUri(uri: string): string {\n  if (!uri) return \"\";\n  try {\n    if (uri.startsWith(\"file://\")) {\n      return path.basename(fileURLToPath(uri));\n    }\n  } catch {\n    // ignore decoding issues\n  }\n  try {\n    return path.basename(new URL(uri).pathname);\n  } catch {\n    return uri;\n  }\n}\n\n/* ============================================================================\n * API\n * ========================================================================== */\n\nexport function provideCompletions(doc: TextDocument, position: Position): CompletionItem[] {\n  const items: CompletionItem[] = [];\r\n  const { token, range } = currentToken(doc, position);\r\n  const linePrefix = getLinePrefix(doc, position);\r\n\r\n  // Mots-clés\r\n  for (const kw of KEYWORDS) {\r\n    const score = fuzzyScore(kw, token);\r\n    if (score > 0) {\r\n      items.push({\r\n        label: kw,\r\n        kind: CompletionItemKind.Keyword,\r\n        detail: \"Mot-clé\",\r\n        documentation: md(`Mot-clé du langage \\`${kw}\\`.`),\r\n        sortText: tier(2 - (score >= 2 ? 1 : 0), kw),\r\n        filterText: kw,\r\n        textEdit: edit(range, kw),\r\n        preselect: kw === \"fn\" || kw === \"let\",\r\n        commitCharacters: [\" \", \"\\t\", \"(\", \")\", \"{\", \"}\", \"[\", \"]\", \";\", \",\", \".\"],\r\n        labelDetails: { description: \"keyword\" }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Littéraux\n  for (const lit of [...BOOL_LITERALS, ...NIL_LITERALS]) {\n    if (fuzzyScore(lit, token) > 0) {\n      items.push({\n        label: lit,\r\n        kind: CompletionItemKind.Value,\r\n        detail: \"Littéral\",\r\n        documentation: md(`Littéral \\`${lit}\\`.`),\r\n        sortText: tier(2, `~${lit}`),\r\n        textEdit: edit(range, lit),\r\n        labelDetails: { description: \"literal\" }\r\n      });\n    }\n  }\n\n  // Types primitifs\n  for (const ty of PRIMITIVE_TYPES) {\n    if (fuzzyScore(ty, token) > 0) {\n      items.push({\n        label: ty,\n        kind: CompletionItemKind.TypeParameter,\n        detail: \"Type primitif\",\n        documentation: md(`Type primitif \\`${ty}\\`.`),\n        sortText: tier(2, `type:${ty}`),\n        textEdit: edit(range, ty),\n        labelDetails: { description: \"type\" }\n      });\n    }\n  }\n\n  // Fonctions builtin\n  for (const fn of BUILTIN_FUNCTIONS) {\n    if (fuzzyScore(fn, token) > 0) {\n      items.push({\n        label: fn,\n        kind: CompletionItemKind.Function,\n        detail: \"Builtin\",\n        documentation: md(`Fonction builtin \\`${fn}\\`.`),\n        sortText: tier(2, `builtin:${fn}`),\n        textEdit: edit(range, fn),\n        labelDetails: { description: \"builtin\" }\n      });\n    }\n  }\n\r\n  // Snippets\r\n  for (const it of SNIPPETS) {\r\n    items.push({\r\n      ...it,\r\n      sortText: tier(3, it.label),\r\n      filterText: it.label\r\n    });\r\n  }\r\n\n  // Symboles du document\n  for (const s of extractSymbols(doc)) {\n    const label = s.name;\n    if (fuzzyScore(label, token) > 0) {\n      items.push({\r\n        label,\r\n        kind: mapSymbolKindToCompletionKind(s.kind),\r\n        detail: `Symbole (${SYMBOL_KIND_LABEL[s.kind] ?? \"?\"})`,\r\n        documentation: md(\"Déclaré dans ce document.\"),\r\n        sortText: tier(1, label),\r\n        filterText: label,\r\n        textEdit: edit(range, label),\r\n        labelDetails: { description: SYMBOL_KIND_LABEL[s.kind] ?? \"symbol\" }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Contexte: membres après un point\n  items.push(...memberCompletion(linePrefix));\n\n  // Contexte: import et autres heuristiques\n  const isImportContext = /^\\s*import\\s+/.test(linePrefix);\n\n  items.push(...diagnosticsCompletion(linePrefix).map(ci => ({\n    ...ci,\n    textEdit: ci.insertText ? undefined : edit(range, ci.label),\n    sortText: ci.sortText ?? tier(0, ci.label)\n  })));\n\n  if (isImportContext) {\n    items.push(...workspaceSymbolCompletions(doc, token, range, \"import\"));\n  } else if (token.length >= 2) {\n    items.push(...workspaceSymbolCompletions(doc, token, range, \"general\"));\n  }\n\n  return dedupe(items, it => `${it.label}|${it.kind}|${it.sortText ?? \"\"}`);\n}\n\r\nexport function resolveCompletion(item: CompletionItem): CompletionItem {\r\n  if (!item.documentation && typeof item.label === \"string\") {\r\n    item.documentation = md(`Entrée de complétion \\`${item.label}\\`.`);\r\n  }\r\n  return item;\r\n}\r\n\r\nexport function triggerCharacters(): string[] {\r\n  return [\".\", \":\", \">\", \"=\", \" \", \"(\", \"[\", \"{\", \"\\\"\", \"'\"];\r\n}\r\n\r\n/* ============================================================================\r\n * Helpers\r\n * ========================================================================== */\r\n\r\nfunction ciSnippet(label: string, detail: string, documentation: string, insertText: string): CompletionItem {\r\n  return {\r\n    label,\r\n    kind: CompletionItemKind.Snippet,\r\n    insertText,\r\n    insertTextFormat: InsertTextFormat.Snippet,\r\n    detail,\r\n    documentation: md(documentation)\r\n  };\r\n}\r\n\r\nfunction tier(n: number, suffix = \"\"): string {\r\n  // 0 = top, 1 = symboles, 2 = mots-clés/littéraux, 3 = snippets\r\n  return `${n.toString(10).padStart(2, \"0\")}_${suffix}`;\r\n}\r\n\r\nfunction md(value: string): MarkupContent {\r\n  return { kind: MarkupKind.Markdown, value };\r\n}\r\n\r\nfunction edit(range: Range, newText: string): TextEdit {\r\n  return { range, newText };\r\n}\r\n\r\nfunction dedupe<T>(arr: T[], key: (t: T) => string): T[] {\r\n  const seen = new Set<string>();\r\n  const out: T[] = [];\r\n  for (const el of arr) {\r\n    const k = key(el);\r\n    if (seen.has(k)) continue;\r\n    seen.add(k);\r\n    out.push(el);\r\n  }\r\n  return out;\r\n}\r\n"]}