{"version":3,"file":"formatting.js","sourceRoot":"","sources":["../../src/formatting.ts"],"names":[],"mappings":"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","sourcesContent":["// formatting.ts — formateur LSP déterministe, idempotent et paramétrable\r\n\r\nimport {\n  TextEdit,\n  Range,\n  Position,\n} from \"vscode-languageserver\";\nimport type { FormattingOptions } from \"vscode-languageserver\";\nimport type { TextDocument } from \"vscode-languageserver-textdocument\";\n\r\n/* ============================================================================\r\n * Options étendues\r\n * ========================================================================== */\r\n\r\nexport interface ExtraFormattingOptions extends FormattingOptions {\r\n  trimTrailingWhitespace?: boolean;\r\n  insertFinalNewline?: boolean;\r\n  trimFinalNewlines?: boolean;\r\n\r\n  normalizeEOL?: \"lf\" | \"crlf\";\r\n  maxConsecutiveBlankLines?: number;\r\n\r\n  ensureSpaceAroundOperators?: boolean;\r\n  spaceAfterComma?: boolean;\r\n  spaceAroundColon?: \"none\" | \"left\" | \"right\" | \"both\"; // ex: key: value\r\n\r\n  normalizeQuotes?: \"preserve\" | \"double\" | \"single\";\r\n  keepIndentInsideStrings?: boolean;\r\n\r\n  alignInlineComments?: boolean;\r\n  alignEquals?: boolean; // simple alignement des '=' sur blocs contigus\r\n\r\n  braceStyle?: \"attach\" | \"break\"; // if (...) {\\n vs if (...)\\n{\r\n  newlineBeforeElse?: boolean;     // } else { vs }\\nelse {\r\n\r\n  // Limiteur doux: wrap des commentaires uniquement\r\n  wrapCommentsAt?: number; // 80, 100, 120...\r\n}\r\n\r\n/* ============================================================================\r\n * API principale\r\n * ========================================================================== */\r\n\r\nexport function provideFormattingEdits(\r\n  doc: TextDocument,\r\n  options: ExtraFormattingOptions = {\r\n    tabSize: 2,\r\n    insertSpaces: true,\r\n    trimTrailingWhitespace: true,\r\n    insertFinalNewline: true,\r\n    trimFinalNewlines: true,\r\n\r\n    normalizeEOL: \"lf\",\r\n    maxConsecutiveBlankLines: 2,\r\n\r\n    ensureSpaceAroundOperators: true,\r\n    spaceAfterComma: true,\r\n    spaceAroundColon: \"right\",\r\n\r\n    normalizeQuotes: \"preserve\",\r\n    keepIndentInsideStrings: true,\r\n\r\n    alignInlineComments: true,\r\n    alignEquals: true,\r\n\r\n    braceStyle: \"attach\",\r\n    newlineBeforeElse: false,\r\n\r\n    wrapCommentsAt: 100,\r\n  }\r\n): TextEdit[] {\r\n  const original = doc.getText();\r\n  const lines = splitLines(original);\r\n\r\n  const outLines = formatLines(lines, options);\r\n  let text = joinWithEOL(outLines, options.normalizeEOL ?? \"lf\");\r\n\r\n  // Trim final newlines\r\n  if (options.trimFinalNewlines) {\r\n    text = text.replace(/\\n+$/g, \"\\n\");\r\n  }\r\n\r\n  // Enforce final newline\r\n  if (options.insertFinalNewline && !text.endsWith(\"\\n\")) {\r\n    text += \"\\n\";\r\n  }\r\n\r\n  // Early exit si inchangé (après normalisation EOL)\r\n  const normalizedOrig = joinWithEOL(splitLines(original), options.normalizeEOL ?? \"lf\");\r\n  if (normalizedOrig === text) return [];\r\n\r\n  return [TextEdit.replace(fullRange(doc), text)];\r\n}\r\n\r\nexport function formatDocument(\n  doc: TextDocument,\n  options?: ExtraFormattingOptions\n): TextEdit[] {\n  // Ne plus passer {} : on laisse le paramètre non défini pour déclencher les valeurs par défaut\n  return provideFormattingEdits(doc, options);\n}\n\r\n/* ============================================================================\r\n * Formatage par passes\r\n * ========================================================================== */\r\n\r\nfunction formatLines(src: string[], opt: ExtraFormattingOptions): string[] {\r\n  const tabSize = opt.tabSize ?? 2;\r\n  const indentUnit = (opt.insertSpaces ?? true) ? \" \".repeat(tabSize) : \"\\t\";\r\n\r\n  // Pass 1: normalisation indentation + espaces élémentaires + style d’accolades\r\n  let lines = passIndentAndSpacing(src, indentUnit, tabSize, opt);\r\n\r\n  // Pass 2: limitation des lignes vides\r\n  lines = limitBlankRuns(lines, opt.maxConsecutiveBlankLines ?? 2);\r\n\r\n  // Pass 3: alignement facultatif des commentaires inline\r\n  if (opt.alignInlineComments) {\r\n    lines = alignEndOfLineComments(lines);\r\n  }\r\n\r\n  // Pass 4: alignement simple des '=' sur blocs contigus\r\n  if (opt.alignEquals) {\r\n    lines = alignEqualsBlocks(lines);\r\n  }\r\n\r\n  // Pass 5: wrap des commentaires\r\n  if (opt.wrapCommentsAt && opt.wrapCommentsAt > 10) {\r\n    lines = wrapCommentLines(lines, opt.wrapCommentsAt);\r\n  }\r\n\r\n  return lines;\r\n}\r\n\r\n/* ============================================================================\r\n * Pass 1 — indentation, espaces, quotes, comma/colon, style accolades\r\n * ========================================================================== */\r\n\r\nfunction passIndentAndSpacing(\r\n  src: string[],\r\n  indentUnit: string,\r\n  tabSize: number,\r\n  opt: ExtraFormattingOptions\r\n): string[] {\r\n  const out: string[] = [];\r\n  let indentLevel = 0;\r\n\r\n  for (let raw of src) {\n    // EOL retiré au split\r\n\r\n    // Normalisation indentation hard/soft\r\n    raw = normalizeIndent(raw, indentUnit, tabSize, (opt.insertSpaces ?? true));\r\n\r\n    // Brace style: détecter pré-décrément si ligne commence par fermante\r\n    const preDec = startsWithClosingBracket(raw) ? 1 : 0;\r\n\r\n    // Appliquer indentation\r\n    let line = applyIndentHeuristic(raw, Math.max(0, indentLevel - preDec), indentUnit);\r\n\r\n    // Normaliser quotes simples/doubles (hors chaînes déjà en cours)\r\n    if (opt.normalizeQuotes && opt.normalizeQuotes !== \"preserve\") {\r\n      line = normalizeQuotesInLine(line, opt.normalizeQuotes);\r\n    }\r\n\r\n    // Espaces autour des opérateurs (hors chaînes)\r\n    if (opt.ensureSpaceAroundOperators) {\r\n      line = ensureSpacesAroundOpsOutsideStrings(line);\r\n    }\r\n\r\n    // Espaces après virgules\r\n    if (opt.spaceAfterComma) {\r\n      line = ensureSpaceAfterCommasOutsideStrings(line);\r\n    }\r\n\r\n    // Espaces autour des ':'\r\n    if (opt.spaceAroundColon && opt.spaceAroundColon !== \"none\") {\r\n      line = ensureSpaceAroundColonOutsideStrings(line, opt.spaceAroundColon);\r\n    }\r\n\r\n    // Style des accolades\r\n    line = applyBraceStyle(line, opt.braceStyle ?? \"attach\");\r\n\r\n    // Newline before else\r\n    if (opt.newlineBeforeElse) {\n      line = applyNewlineBeforeElse(line);\n    }\n\r\n    // Trim trailing whitespace\r\n    if (opt.trimTrailingWhitespace ?? true) {\r\n      line = line.replace(/[ \\t]+$/g, \"\");\r\n    }\r\n\r\n    out.push(line);\r\n\r\n    // Ajuster indentLevel pour la ligne suivante\r\n    indentLevel += netBracketDelta(raw);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/* ============================================================================\r\n * Limitation des suites de lignes vides\r\n * ========================================================================== */\r\n\r\nfunction limitBlankRuns(lines: string[], maxBlank: number): string[] {\r\n  const out: string[] = [];\r\n  let run = 0;\r\n  for (const l of lines) {\r\n    if (/^\\s*$/.test(l)) {\r\n      run++;\r\n      if (run <= maxBlank) out.push(\"\");\r\n    } else {\r\n      run = 0;\r\n      out.push(l);\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\n/* ============================================================================\r\n * Indentation utilitaires\r\n * ========================================================================== */\r\n\r\nfunction normalizeIndent(\r\n  line: string,\r\n  indentUnit: string,\r\n  tabSize: number,\r\n  useSpaces: boolean\r\n): string {\r\n  const m = /^([ \\t]*)/.exec(line);\r\n  const lead = m ? m[1] : \"\";\r\n  const body = line.slice(lead.length);\r\n\r\n  if (useSpaces) {\r\n    const expanded = lead.replace(/\\t/g, \" \".repeat(tabSize));\r\n    return expanded + body;\r\n  } else {\r\n    const width = visualWidth(lead, tabSize);\r\n    const tabs = \"\\t\".repeat(Math.floor(width / tabSize));\r\n    const spaces = \" \".repeat(width % tabSize);\r\n    return tabs + spaces + body;\r\n  }\r\n}\r\n\r\nfunction applyIndentHeuristic(\r\n  line: string,\r\n  level: number,\r\n  indentUnit: string\r\n): string {\r\n  const body = line.replace(/^[ \\t]+/, \"\");\r\n  return indentUnit.repeat(Math.max(0, level)) + body;\r\n}\r\n\r\nfunction netBracketDelta(line: string): number {\n  const s = stripStrings(line);\n  const opens = s.match(/[{\\[(]/g)?.length ?? 0;\n  const closes = s.match(/[}\\])]/g)?.length ?? 0;\n  return opens - closes;\n}\n\r\nfunction startsWithClosingBracket(line: string): boolean {\r\n  const s = line.replace(/^[ \\t]+/, \"\");\r\n  return /^[}\\])]/.test(s);\r\n}\r\n\r\n/* ============================================================================\r\n * Espaces — opérateurs, virgules, colon\r\n * ========================================================================== */\r\n\r\nfunction ensureSpacesAroundOpsOutsideStrings(line: string): string {\r\n  const ops = [\r\n    \"\\\\+=\", \"-=\", \"\\\\*=\", \"/=\", \"%=\", \"<<=\", \">>=\", \"&=\", \"\\\\^=\", \"\\\\|=\",\r\n    \"===\", \"!==\", \"==\", \"!=\", \"<=\", \">=\", \"&&\", \"\\\\|\\\\|\", \"<<\", \">>\",\r\n    \"\\\\+\", \"-\", \"\\\\*\", \"/\", \"%\", \"<\", \">\", \"=\", \"&\", \"\\\\|\", \"\\\\^\",\r\n  ];\r\n  const rx = new RegExp(`\\\\s*(${ops.join(\"|\")})\\\\s*`, \"g\");\r\n  return rewriteOutsideStrings(line, (chunk) => chunk.replace(rx, \" $1 \").replace(/ {2,}/g, \" \"));\r\n}\r\n\r\nfunction ensureSpaceAfterCommasOutsideStrings(line: string): string {\r\n  return rewriteOutsideStrings(line, (chunk) =>\r\n    chunk.replace(/\\s*,\\s*/g, \", \").replace(/, +([,\\]\\)}])/g, \",$1\")\r\n  );\r\n}\r\n\r\nfunction ensureSpaceAroundColonOutsideStrings(\r\n  line: string,\r\n  mode: \"left\" | \"right\" | \"both\"\r\n): string {\r\n  return rewriteOutsideStrings(line, (chunk) => {\r\n    switch (mode) {\r\n      case \"left\":  return chunk.replace(/\\s*:\\s*/g, \" :\");\r\n      case \"both\":  return chunk.replace(/\\s*:\\s*/g, \" : \");\r\n      case \"right\": default: return chunk.replace(/\\s*:\\s*/g, \": \");\r\n    }\r\n  });\r\n}\r\n\r\n/* ============================================================================\r\n * Quotes normalisation (hors chaînes)\r\n * ========================================================================== */\r\n\r\nfunction normalizeQuotesInLine(line: string, target: \"double\" | \"single\"): string {\r\n  return rewriteStrings(line, (content, quote) => {\r\n    if (target === \"double\" && quote === \"'\") {\r\n      if (!content.includes(\"\\\"\")) return `\"${content.replace(/\"/g, \"\\\\\\\"\")}\"`;\r\n    }\r\n    if (target === \"single\" && quote === \"\\\"\") {\r\n      if (!content.includes(\"'\")) return `'${content.replace(/'/g, \"\\\\'\")}'`;\r\n    }\r\n    return `${quote}${content}${quote}`;\r\n  });\r\n}\r\n\r\n/* ============================================================================\r\n * Style d’accolades et else\r\n * ========================================================================== */\r\n\r\nfunction applyBraceStyle(line: string, style: \"attach\" | \"break\"): string {\r\n  if (style === \"attach\") {\r\n    return line.replace(/\\)\\s*\\{\\s*$/, \") {\");\r\n  } else {\r\n    return line.replace(/\\)\\s*\\{\\s*$/, \")\\n{\");\r\n  }\r\n}\r\n\r\nfunction applyNewlineBeforeElse(line: string): string {\n  if (!/^\\s*else\\b/.test(line) && /}\\s*else\\b/.test(line)) {\n    return line.replace(/}\\s*else\\b/g, \"}\\nelse\");\n  }\n  return line;\n}\n\r\n/* ============================================================================\r\n * Alignements\r\n * ========================================================================== */\r\n\r\nfunction alignEndOfLineComments(lines: string[]): string[] {\n  const info: { idx: number; code: string; comment: string }[] = [];\n  let maxCode = 0;\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const { code, comment } = splitCodeAndComment(lines[i]);\r\n    if (comment) {\r\n      const codeTrim = code.replace(/[ \\t]+$/g, \"\");\r\n      maxCode = Math.max(maxCode, codeTrim.length);\r\n      info.push({ idx: i, code: codeTrim, comment });\r\n    }\r\n  }\r\n  if (info.length === 0) return lines;\r\n\r\n  const out = [...lines];\r\n  for (const { idx, code, comment } of info) {\r\n    const pad = \" \".repeat(Math.max(1, maxCode - code.length + 1));\r\n    out[idx] = code + pad + comment;\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction alignEqualsBlocks(lines: string[]): string[] {\r\n  const out = [...lines];\r\n  let i = 0;\r\n  while (i < out.length) {\r\n    const block: number[] = [];\r\n    while (i < out.length) {\r\n      const l = out[i];\r\n      if (/^\\s*$/.test(l)) break;\r\n      const sc = stripStrings(l);\r\n      if (sc.includes(\"=\") && !/^\\s*\\/\\//.test(sc)) block.push(i);\n      else if (block.length > 0) break;\r\n      i++;\r\n    }\r\n    if (block.length >= 2) {\r\n      let col = 0;\r\n      for (const idx of block) {\r\n        const before = out[idx].split(\"=\")[0] ?? \"\";\r\n        const w = visualWidth(before, 2);\r\n        col = Math.max(col, w);\r\n      }\r\n      for (const idx of block) {\r\n        const parts = out[idx].split(\"=\");\r\n        const left = parts.shift() ?? \"\";\r\n        const right = parts.join(\"=\");\r\n        const pad = \" \".repeat(Math.max(1, col - visualWidth(left, 2)));\r\n        out[idx] = left.replace(/[ \\t]+$/g, \"\") + pad + \" = \" + right.replace(/^\\s+/, \"\");\r\n      }\r\n    }\r\n    i++;\r\n  }\r\n  return out;\r\n}\r\n\r\n/* ============================================================================\r\n * Wrap de commentaires\r\n * ========================================================================== */\r\n\r\nfunction wrapCommentLines(lines: string[], max: number): string[] {\r\n  const out: string[] = [];\r\n  for (const l of lines) {\r\n    const m = /^(\\s*\\/\\/\\s?)(.*)$/.exec(l);\r\n    if (!m) { out.push(l); continue; }\r\n    const prefix = m[1];\r\n    const body = m[2].trim();\r\n    const wrapped = wrapText(body, max - visualWidth(prefix, 2));\r\n    for (const w of wrapped) out.push(prefix + w);\r\n  }\r\n  return out;\r\n}\r\n\r\n/* ============================================================================\r\n * EOL / Ranges\r\n * ========================================================================== */\r\n\r\nfunction splitLines(text: string): string[] {\r\n  return text.replace(/\\r\\n/g, \"\\n\").split(/\\n/);\r\n}\r\n\r\nfunction joinWithEOL(lines: string[], mode: \"lf\" | \"crlf\"): string {\r\n  const lf = lines.join(\"\\n\");\r\n  return mode === \"crlf\" ? lf.replace(/\\n/g, \"\\r\\n\") : lf;\r\n}\r\n\r\nfunction fullRange(doc: TextDocument): Range {\r\n  const lastLine = Math.max(0, doc.lineCount - 1);\r\n  const lastText = doc.getText(Range.create(\r\n    Position.create(lastLine, 0),\r\n    Position.create(lastLine, Number.MAX_SAFE_INTEGER)\r\n  ));\r\n  return Range.create(Position.create(0, 0), Position.create(lastLine, lastText.length));\r\n}\r\n\r\n/* ============================================================================\r\n * Analyse chaînes / commentaires et réécriture sécurisée\r\n * ========================================================================== */\r\n\r\nfunction stripStrings(s: string): string {\r\n  let out = \"\";\r\n  let inStr: '\"' | \"'\" | null = null;\r\n  for (let i = 0; i < s.length; i++) {\r\n    const ch = s[i];\r\n    if (inStr) {\r\n      if (ch === \"\\\\\") { i++; continue; }\r\n      if (ch === inStr) inStr = null;\r\n      continue;\r\n    }\r\n    if (ch === '\"' || ch === \"'\") {\n      inStr = ch;\n      continue;\r\n    }\r\n    out += ch;\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction splitCodeAndComment(line: string): { code: string; comment: string } {\r\n  let inStr: '\"' | \"'\" | null = null;\r\n  for (let i = 0; i < line.length; i++) {\r\n    const ch = line[i];\r\n    if (inStr) {\r\n      if (ch === \"\\\\\") { i++; continue; }\r\n      if (ch === inStr) inStr = null;\r\n      continue;\r\n    }\r\n    if (ch === '\"' || ch === \"'\") { inStr = ch; continue; }\n    if (ch === \"/\" && i + 1 < line.length && line[i + 1] === \"/\") {\r\n      return { code: line.slice(0, i), comment: line.slice(i) };\r\n    }\r\n    // support /* ... */ inline (simplifié)\r\n    if (ch === \"/\" && i + 1 < line.length && line[i + 1] === \"*\") {\r\n      const j = line.indexOf(\"*/\", i + 2);\r\n      if (j >= 0) {\r\n        return { code: line.slice(0, i), comment: line.slice(i, j + 2) };\r\n      }\r\n    }\r\n  }\r\n  return { code: line, comment: \"\" };\r\n}\r\n\r\n/** Réécrit les segments hors chaînes */\r\nfunction rewriteOutsideStrings(line: string, fn: (chunk: string) => string): string {\r\n  let out = \"\";\r\n  let i = 0;\r\n  let inStr: '\"' | \"'\" | null = null;\r\n\r\n  while (i < line.length) {\r\n    const ch = line[i];\r\n\r\n    if (inStr) {\r\n      out += ch;\r\n      if (ch === \"\\\\\") {\r\n        if (i + 1 < line.length) { out += line[i + 1]; i += 2; continue; }\r\n      } else if (ch === inStr) {\r\n        inStr = null;\r\n      }\r\n      i++;\r\n      continue;\r\n    }\r\n\r\n    if (ch === '\"' || ch === \"'\") {\n      inStr = ch;\n      out += ch;\r\n      i++;\r\n      continue;\r\n    }\r\n\r\n    // accumule chunk jusqu’à prochaine quote\r\n    let j = i;\r\n    while (j < line.length && line[j] !== \"'\" && line[j] !== \"\\\"\") j++;\r\n    const chunk = line.slice(i, j);\r\n    out += fn(chunk);\r\n    i = j;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/** Réécrit les chaînes elles-mêmes via callback (contenu + quote) */\r\nfunction rewriteStrings(line: string, fn: (content: string, quote: string) => string): string {\r\n  let out = \"\";\r\n  let i = 0;\r\n  while (i < line.length) {\r\n    const ch = line[i];\r\n    if (ch !== \"'\" && ch !== \"\\\"\") { out += ch; i++; continue; }\r\n    const quote = ch;\r\n    i++;\r\n    let content = \"\";\r\n    while (i < line.length) {\r\n      const c = line[i];\r\n      if (c === \"\\\\\") { content += c; if (i + 1 < line.length) { content += line[i + 1]; i += 2; continue; } }\r\n      if (c === quote) { i++; break; }\r\n      content += c; i++;\r\n    }\r\n    out += fn(content, quote);\r\n  }\r\n  return out;\r\n}\r\n\r\n/* ============================================================================\r\n * Wrap simple\r\n * ========================================================================== */\r\n\r\nfunction wrapText(s: string, width: number): string[] {\r\n  if (s.length <= width) return [s];\r\n  const words = s.split(/\\s+/);\r\n  const lines: string[] = [];\r\n  let cur = \"\";\r\n  for (const w of words) {\r\n    if (cur.length === 0) { cur = w; continue; }\r\n    if (cur.length + 1 + w.length <= width) cur += \" \" + w;\r\n    else { lines.push(cur); cur = w; }\r\n  }\r\n  if (cur.length) lines.push(cur);\r\n  return lines;\r\n}\r\n\r\n/* ============================================================================\r\n * Divers\r\n * ========================================================================== */\r\n\r\nfunction visualWidth(s: string, tabSize: number): number {\r\n  let w = 0;\r\n  for (const ch of s) {\r\n    if (ch === \"\\t\") w += tabSize - (w % tabSize);\r\n    else w += 1;\r\n  }\r\n  return w;\r\n}\r\n"]}