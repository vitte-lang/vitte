{"version":3,"file":"server.js","sourceRoot":"","sources":["../../src/server.ts"],"names":[],"mappings":"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","sourcesContent":["// server.ts â€” Vitte/Vit hardened LSP server\n// Goals:\n// - Full capabilities: completion, hover, symbols, def/refs, rename, formatting, diagnostics, semantic tokens\n// - Dynamic config management + watchers + graceful shutdown\n// - Lint with debounce, size guards, cancellation\n// - Controlled logging, lightweight metrics, pervasive try/catch\n\nimport {\n  createConnection,\n  ProposedFeatures,\n  TextDocumentSyncKind,\n  TextDocuments,\n  TextEdit,\n  DidChangeConfigurationNotification,\n  FileChangeType,\n} from \"vscode-languageserver/node\";\nimport type {\n  Connection,\n  InitializeParams,\n  InitializeResult,\n  CompletionParams,\n  CompletionItem,\n  HoverParams,\n  Hover,\n  DocumentSymbolParams,\n  DocumentSymbol,\n  DocumentFormattingParams,\n  SemanticTokens,\n  SemanticTokensParams,\n  SemanticTokensLegend,\n  WorkspaceSymbolParams,\n  WorkspaceSymbol,\n  DefinitionParams,\n  Location,\n  ReferenceParams,\n  RenameParams,\n  PrepareRenameParams,\n  Range,\n  WorkspaceEdit,\n  CancellationToken,\n  RemoteWorkspace,\n} from \"vscode-languageserver/node\";\nimport { TextDocument } from \"vscode-languageserver-textdocument\";\n\n/* Modules internes */\nimport { provideCompletions, resolveCompletion, triggerCharacters } from \"./completion.js\";\nimport {\n  documentSymbols,\n  definitionAtPosition,\n  referencesAtPosition,\n  renameSymbol,\n  prepareRename,\n  workspaceSymbols,\n} from \"./navigation.js\";\nimport { provideFormattingEdits } from \"./formatting.js\";\nimport { getSemanticTokensLegend, buildSemanticTokens, provideHover } from \"./semantic.js\";\nimport { lintToPublishable } from \"./lint.js\";\nimport { registerCommands } from \"./commands.js\";\nimport { indexDocument as indexWorkspaceDocument, removeDocument as removeWorkspaceDocument, clearIndex, exportIndexSnapshot, loadIndexSnapshot, type IndexSnapshot } from \"./indexer.js\";\nimport * as fs from \"node:fs/promises\";\nimport * as path from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\n\nconst createSemanticTokens: (doc: TextDocument) => SemanticTokens = buildSemanticTokens;\n\ninterface MetricAggregate {\n  count: number;\n  totalMs: number;\n  maxMs: number;\n  lastMs: number;\n  lastAt: number;\n  lastUri: string;\n  lastCount?: number;\n  errorCount: number;\n  lastError?: string;\n  samples: number[];\n}\n\nconst metricStore = new Map<string, MetricAggregate>();\n\n/* --------------------------- Connection + documents ----------------------- */\nconst connection: Connection = createConnection(ProposedFeatures.all);\nconst documents = new TextDocuments<TextDocument>(TextDocument);\nfunction emptySemanticTokens(): SemanticTokens {\n  return { data: [] };\n}\n\n/* ------------------------------- Configuration --------------------------- */\ninterface ServerSettings {\n  trace: \"off\" | \"messages\" | \"verbose\";\n  traceSampleRate: number;\n  lintDebounceMs: number;\n  enableFormatting: boolean;\n  maxFileSizeKB: number; // above this limit, skip lint + semantic tokens to preserve perf\n  requestTimeoutMs: number;\n  requestTimeouts: {\n    completion?: number;\n    hover?: number;\n    definition?: number;\n    references?: number;\n    rename?: number;\n    documentSymbols?: number;\n    workspaceSymbols?: number;\n    semanticTokens?: number;\n    formatting?: number;\n  };\n  requestMaxConcurrent: number;\n  indexerMaxRssMB: number;\n  indexerCacheEnabled: boolean;\n  lint: {\n    maxLineLength?: number;\n    allowTabs?: boolean;\n    allowTrailingWhitespace?: boolean;\n    enableStyleRules?: boolean;\n  };\n  features: {\n    completion: boolean;\n    hover: boolean;\n    definition: boolean;\n    references: boolean;\n    rename: boolean;\n    documentSymbols: boolean;\n    workspaceSymbols: boolean;\n    semanticTokens: boolean;\n    formatting: boolean;\n    lint: boolean;\n  };\n}\n\nconst DEFAULT_SETTINGS: ServerSettings = {\n  trace: \"off\",\n  traceSampleRate: 0.01,\n  lintDebounceMs: 200,\n  enableFormatting: true,\n  maxFileSizeKB: 1024, // 1 MB\n  requestTimeoutMs: 800,\n  requestTimeouts: {},\n  requestMaxConcurrent: 4,\n  indexerMaxRssMB: 1024,\n  indexerCacheEnabled: true,\n  lint: {},\n  features: {\n    completion: true,\n    hover: true,\n    definition: true,\n    references: true,\n    rename: true,\n    documentSymbols: true,\n    workspaceSymbols: true,\n    semanticTokens: true,\n    formatting: true,\n    lint: true,\n  },\n};\n\nlet globalSettings: ServerSettings = { ...DEFAULT_SETTINGS };\nlet hasConfigurationCapability = false;\nlet hasWorkspaceFoldersCapability = false;\nlet workspaceRoot: string | undefined;\n\nconnection.onInitialize((params: InitializeParams): InitializeResult => {\n  const capabilities = params.capabilities;\n  hasConfigurationCapability = !!capabilities.workspace?.configuration;\n  hasWorkspaceFoldersCapability = !!capabilities.workspace?.workspaceFolders;\n\n  const legend: SemanticTokensLegend = getSemanticTokensLegend();\n\n  const result: InitializeResult = {\n    capabilities: {\n      textDocumentSync: TextDocumentSyncKind.Incremental,\n      // Enable resolve to enrich completion items lazily and use centralized trigger characters\n      completionProvider: { resolveProvider: true, triggerCharacters: triggerCharacters() },\n      hoverProvider: true,\n      documentSymbolProvider: true,\n      documentFormattingProvider: true,\n      definitionProvider: true,\n      referencesProvider: true,\n      renameProvider: { prepareProvider: true },\n      workspaceSymbolProvider: true,\n      semanticTokensProvider: { legend, full: true, range: false },\n    },\n  };\n\n  if (hasWorkspaceFoldersCapability) {\n    result.capabilities.workspace = { workspaceFolders: { supported: true } };\n  }\n  return result;\n});\n\nconnection.onInitialized(() => {\n  registerCommands(connection);\n  if (hasConfigurationCapability) {\n    void connection.client.register(DidChangeConfigurationNotification.type, undefined);\n  }\n  // Watch classiques pour compat large versions du client\n  connection.onDidChangeWatchedFiles((change) => {\n    for (const ev of change.changes) {\n      if (ev.type === FileChangeType.Deleted) {\n        void connection.sendDiagnostics({ uri: ev.uri, diagnostics: [] });\n      }\n    }\n  });\n  void loadIndexCache();\n});\n\nconnection.onRequest(\"vitte/metrics\", () => {\n  const snapshot = Array.from(metricStore.entries()).map(([name, data]) => ({\n    name,\n    count: data.count,\n    averageMs: data.count > 0 ? data.totalMs / data.count : 0,\n    maxMs: data.maxMs,\n    lastMs: data.lastMs,\n    lastAt: data.lastAt,\n    lastUri: data.lastUri,\n    lastCount: data.lastCount ?? null,\n    p99Ms: percentile(data.samples, 99),\n    errorCount: data.errorCount,\n    lastError: data.lastError ?? null,\n  }));\n  snapshot.sort((a, b) => b.averageMs - a.averageMs);\n  return snapshot;\n});\n\nconnection.onRequest(\"vitte/metrics.reset\", () => {\n  metricStore.clear();\n  return { ok: true };\n});\n\nconnection.onRequest(\"vitte/ping\", () => {\n  return { ok: true, ts: Date.now() };\n});\n\nconnection.onShutdown(() => {\n  for (const t of lintTimers.values()) clearTimeout(t);\n  lintTimers.clear();\n  void saveIndexCache();\n  clearIndex();\n});\n\n/* ------------------------------- Config updates --------------------------- */\nasync function applyConfiguration(): Promise<void> {\n  const workspace = Reflect.get(connection, \"workspace\") as RemoteWorkspace | undefined;\n  if (hasConfigurationCapability && workspace) {\n    try {\n      const cfg = await workspace.getConfiguration({ section: \"vitte\" }) as Partial<ServerSettings> | null | undefined;\n      const lintCfg = await workspace.getConfiguration({ section: \"vitte.lint\" }) as Partial<ServerSettings[\"lint\"]> | null | undefined;\n      const merged: ServerSettings = { ...DEFAULT_SETTINGS, ...(cfg ?? {}) };\n      merged.lint = { ...DEFAULT_SETTINGS.lint, ...(lintCfg ?? {}) };\n      merged.features = { ...DEFAULT_SETTINGS.features, ...(cfg?.features ?? {}) };\n      merged.lintDebounceMs = clampNumber(merged.lintDebounceMs, 0, 2000, DEFAULT_SETTINGS.lintDebounceMs);\n      merged.maxFileSizeKB = clampNumber(merged.maxFileSizeKB, 64, 10000, DEFAULT_SETTINGS.maxFileSizeKB);\n      merged.requestTimeoutMs = clampNumber(merged.requestTimeoutMs, 100, 5000, DEFAULT_SETTINGS.requestTimeoutMs);\n      merged.traceSampleRate = clampNumber(merged.traceSampleRate, 0, 1, DEFAULT_SETTINGS.traceSampleRate);\n      merged.requestMaxConcurrent = clampNumber(merged.requestMaxConcurrent, 1, 32, DEFAULT_SETTINGS.requestMaxConcurrent);\n      merged.indexerMaxRssMB = clampNumber(merged.indexerMaxRssMB, 256, 8192, DEFAULT_SETTINGS.indexerMaxRssMB);\n      merged.indexerCacheEnabled = cfg?.indexerCacheEnabled ?? DEFAULT_SETTINGS.indexerCacheEnabled;\n      merged.requestTimeouts = { ...DEFAULT_SETTINGS.requestTimeouts, ...(cfg?.requestTimeouts ?? {}) };\n      globalSettings = merged;\n    } catch {\n      globalSettings = { ...DEFAULT_SETTINGS };\n    }\n  } else {\n    globalSettings = { ...DEFAULT_SETTINGS };\n  }\n  for (const doc of documents.all()) scheduleLint(doc);\n}\n\nconnection.onDidChangeConfiguration(() => {\n  void applyConfiguration();\n});\n\n/* --------------------------------- Guards -------------------------------- */\nfunction tooLarge(doc: TextDocument): boolean {\n  const kb = Buffer.byteLength(doc.getText(), \"utf8\") / 1024;\n  return kb > (globalSettings.maxFileSizeKB | 0);\n}\n\nfunction cancelled(token?: CancellationToken): boolean { return !!token?.isCancellationRequested; }\n\nasync function resolveWorkspaceRoot(): Promise<string | undefined> {\n  if (workspaceRoot) return workspaceRoot;\n  try {\n    const folders = await connection.workspace.getWorkspaceFolders();\n    if (!folders || folders.length === 0) return undefined;\n    const first = folders[0].uri;\n    if (first.startsWith(\"file://\")) {\n      workspaceRoot = fileURLToPath(first);\n      return workspaceRoot;\n    }\n  } catch {\n    return undefined;\n  }\n  return undefined;\n}\n\nasync function getIndexCachePath(): Promise<string | undefined> {\n  const root = await resolveWorkspaceRoot();\n  if (!root) return undefined;\n  return path.join(root, \".vitte\", \"index-cache.json\");\n}\n\nfunction isIndexSnapshot(value: unknown): value is IndexSnapshot {\n  if (!value || typeof value !== \"object\") return false;\n  const v = value as { version?: unknown; entries?: unknown };\n  return v.version === 1 && Array.isArray(v.entries);\n}\n\nasync function loadIndexCache(): Promise<void> {\n  if (!globalSettings.indexerCacheEnabled) return;\n  const cachePath = await getIndexCachePath();\n  if (!cachePath) return;\n  try {\n    const raw = await fs.readFile(cachePath, \"utf8\");\n    const parsed = JSON.parse(raw) as unknown;\n    const snapshot: IndexSnapshot | null = isIndexSnapshot(parsed) ? parsed : null;\n    const count = loadIndexSnapshot(snapshot);\n    connection.console.log(`[index] loaded cache (${count} files)`);\n  } catch {\n    // ignore cache errors\n  }\n}\n\nasync function saveIndexCache(): Promise<void> {\n  if (!globalSettings.indexerCacheEnabled) return;\n  const cachePath = await getIndexCachePath();\n  if (!cachePath) return;\n  try {\n    await fs.mkdir(path.dirname(cachePath), { recursive: true });\n    const snapshot = exportIndexSnapshot();\n    await fs.writeFile(cachePath, JSON.stringify(snapshot), \"utf8\");\n  } catch {\n    // ignore cache errors\n  }\n}\n\n/* --------------------------------- Handlers ------------------------------- */\n\nconst breaker = { consecutiveErrors: 0, until: 0 };\nconst BREAKER_THRESHOLD = 5;\nconst BREAKER_COOLDOWN_MS = 30000;\nconst requestQueue: (() => void)[] = [];\nlet activeRequests = 0;\n\nfunction isBreakerActive(): boolean {\n  return Date.now() < breaker.until;\n}\n\nfunction recordSuccess(): void {\n  breaker.consecutiveErrors = 0;\n}\n\nfunction recordFailure(): void {\n  breaker.consecutiveErrors += 1;\n  if (breaker.consecutiveErrors >= BREAKER_THRESHOLD) {\n    breaker.until = Date.now() + BREAKER_COOLDOWN_MS;\n  }\n}\n\nfunction featureEnabled(name: keyof ServerSettings[\"features\"]): boolean {\n  return Boolean(globalSettings.features?.[name]);\n}\n\nasync function withTimeout<T>(task: Promise<T>, ms: number): Promise<T> {\n  if (ms <= 0) return task;\n  let tid: NodeJS.Timeout | undefined;\n  const timeout = new Promise<never>((_, reject) => {\n    tid = setTimeout(() => reject(new Error(\"Request timed out\")), ms);\n  });\n  try {\n    return await Promise.race([task, timeout]);\n  } finally {\n    if (tid) clearTimeout(tid);\n  }\n}\n\nfunction timeoutFor(feature: keyof ServerSettings[\"requestTimeouts\"]): number {\n  const per = globalSettings.requestTimeouts?.[feature];\n  if (typeof per === \"number\" && Number.isFinite(per) && per > 0) return per;\n  return globalSettings.requestTimeoutMs;\n}\n\nasync function withBackpressure<T>(fn: () => Promise<T>): Promise<T> {\n  const max = Math.max(1, globalSettings.requestMaxConcurrent | 0);\n  if (activeRequests >= max) {\n    return new Promise<T>((resolve, reject) => {\n      requestQueue.push(() => {\n        void withBackpressure(fn).then(resolve, reject);\n      });\n    });\n  }\n  activeRequests += 1;\n  try {\n    return await fn();\n  } finally {\n    activeRequests -= 1;\n    if (requestQueue.length && activeRequests < max) {\n      const next = requestQueue.shift();\n      if (next) next();\n    }\n  }\n}\n\nfunction failFast(feature: keyof ServerSettings[\"features\"]): boolean {\n  if (featureEnabled(feature)) return false;\n  connection.console.warn(`[disabled] ${feature} is disabled by configuration`);\n  return true;\n}\n\nfunction memoryExceeded(): boolean {\n  const rss = process.memoryUsage().rss / (1024 * 1024);\n  return rss > globalSettings.indexerMaxRssMB;\n}\n\nconnection.onCompletion(async (params: CompletionParams, token?: CancellationToken): Promise<CompletionItem[]> => {\n  if (failFast(\"completion\")) return [];\n  if (isBreakerActive()) return [];\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return [];\n    try {\n      const result = await withTimeout(Promise.resolve(provideCompletions(doc, params.position)), timeoutFor(\"completion\"));\n      metric(\"completion\", start, doc.uri, result.length);\n      recordSuccess();\n      return result;\n    } catch (e) {\n      metric(\"completion\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"completion\", e);\n      return [];\n    }\n  });\n});\n\n// Allow the client to resolve/enrich completion items on demand (details, docs)\nconnection.onCompletionResolve(async (item: CompletionItem): Promise<CompletionItem> => {\n  if (failFast(\"completion\")) return item;\n  if (isBreakerActive()) return item;\n  return withBackpressure(async () => {\n    const start = now();\n    try {\n      const resolved = await withTimeout(Promise.resolve(resolveCompletion(item)), timeoutFor(\"completion\"));\n      metric(\"completionResolve\", start, \"completionResolve\");\n      recordSuccess();\n      return resolved;\n    } catch (e) {\n      metric(\"completionResolve\", start, \"completionResolve\", undefined, e);\n      recordFailure();\n      logErr(\"completionResolve\", e);\n      return item;\n    }\n  });\n});\n\nconnection.onHover(async (params: HoverParams, token?: CancellationToken): Promise<Hover | null> => {\n  if (failFast(\"hover\")) return null;\n  if (isBreakerActive()) return null;\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return null;\n    try {\n      const hover = await withTimeout(Promise.resolve(provideHover(doc, params.position)), timeoutFor(\"hover\"));\n      metric(\"hover\", start, doc.uri);\n      recordSuccess();\n      return hover;\n    } catch (e) {\n      metric(\"hover\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"hover\", e);\n      return null;\n    }\n  });\n});\n\nconnection.onDocumentSymbol(async (params: DocumentSymbolParams, token?: CancellationToken): Promise<DocumentSymbol[]> => {\n  if (failFast(\"documentSymbols\")) return [];\n  if (isBreakerActive()) return [];\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return [];\n    try {\n      const symbols = await withTimeout(Promise.resolve(documentSymbols(doc)), timeoutFor(\"documentSymbols\"));\n      metric(\"documentSymbols\", start, doc.uri, symbols.length);\n      recordSuccess();\n      return symbols;\n    } catch (e) {\n      metric(\"documentSymbols\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"documentSymbols\", e);\n      return [];\n    }\n  });\n});\n\nconnection.onDocumentFormatting(async (params: DocumentFormattingParams, token?: CancellationToken) => {\n  if (!globalSettings.enableFormatting) return [];\n  if (failFast(\"formatting\")) return [];\n  if (isBreakerActive()) return [];\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return [];\n    try {\n      const edits = await withTimeout(Promise.resolve(provideFormattingEdits(doc, params.options)), timeoutFor(\"formatting\"));\n      metric(\"formatting\", start, doc.uri, edits.length);\n      recordSuccess();\n      return edits;\n    } catch (e) {\n      metric(\"formatting\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"formatting\", e);\n      return [];\n    }\n  });\n});\n\nconnection.onDefinition(async (params: DefinitionParams, token?: CancellationToken): Promise<Location[]> => {\n  if (failFast(\"definition\")) return [];\n  if (isBreakerActive()) return [];\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return [];\n    try {\n      const defs = await withTimeout(Promise.resolve(definitionAtPosition(doc, params.position, params.textDocument.uri)), timeoutFor(\"definition\"));\n      metric(\"definition\", start, doc.uri, defs.length);\n      recordSuccess();\n      return defs;\n    } catch (e) {\n      metric(\"definition\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"definition\", e);\n      return [];\n    }\n  });\n});\n\nconnection.onReferences(async (params: ReferenceParams, token?: CancellationToken): Promise<Location[]> => {\n  if (failFast(\"references\")) return [];\n  if (isBreakerActive()) return [];\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return [];\n    try {\n      const refs = await withTimeout(Promise.resolve(referencesAtPosition(doc, params.position, params.textDocument.uri)), timeoutFor(\"references\"));\n      metric(\"references\", start, doc.uri, refs.length);\n      recordSuccess();\n      return refs;\n    } catch (e) {\n      metric(\"references\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"references\", e);\n      return [];\n    }\n  });\n});\n\nconnection.onPrepareRename(async (params: PrepareRenameParams, token?: CancellationToken): Promise<{ range: Range; placeholder: string } | null> => {\n  if (failFast(\"rename\")) return null;\n  if (isBreakerActive()) return null;\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return null;\n    try {\n      const result = await withTimeout(Promise.resolve(prepareRename(doc, params.position)), timeoutFor(\"rename\"));\n      if (result) metric(\"prepareRename\", start, doc.uri);\n      recordSuccess();\n      return result;\n    } catch (e) {\n      metric(\"prepareRename\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"prepareRename\", e);\n      return null;\n    }\n  });\n});\n\n// Correction de type: renvoie WorkspaceEdit\nconnection.onRenameRequest(async (params: RenameParams, token?: CancellationToken): Promise<WorkspaceEdit | null> => {\n  if (failFast(\"rename\")) return null;\n  if (isBreakerActive()) return null;\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return null;\n    try {\n      const edits = await withTimeout(Promise.resolve(renameSymbol(doc, params.position, params.newName)), timeoutFor(\"rename\"));\n      const we: WorkspaceEdit = { changes: { [doc.uri]: edits.map(e => TextEdit.replace(e.range, e.newText)) } };\n      metric(\"rename\", start, doc.uri, edits.length);\n      recordSuccess();\n      return we;\n    } catch (e) {\n      metric(\"rename\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"rename\", e);\n      return null;\n    }\n  });\n});\n\nconnection.onWorkspaceSymbol(async (params: WorkspaceSymbolParams, token?: CancellationToken): Promise<WorkspaceSymbol[]> => {\n  if (failFast(\"workspaceSymbols\")) return [];\n  if (isBreakerActive()) return [];\n  return withBackpressure(async () => {\n    const start = now();\n    if (cancelled(token)) return [];\n    try {\n      const openDocs = documents.all().map(d => ({ uri: d.uri, doc: d }));\n      const symbols = await withTimeout(Promise.resolve(workspaceSymbols(params.query ?? \"\", openDocs, 200)), timeoutFor(\"workspaceSymbols\"));\n      metric(\"workspaceSymbols\", start, params.query ?? \"\", symbols.length);\n      recordSuccess();\n      return symbols;\n    } catch (e) {\n      metric(\"workspaceSymbols\", start, params.query ?? \"workspaceSymbols\", undefined, e);\n      recordFailure();\n      logErr(\"workspaceSymbols\", e);\n      return [];\n    }\n  });\n});\n\nconnection.languages.semanticTokens.on(async (params: SemanticTokensParams, token?: CancellationToken) => {\n  if (failFast(\"semanticTokens\")) return emptySemanticTokens();\n  if (isBreakerActive()) return emptySemanticTokens();\n  return withBackpressure(async () => {\n    const start = now();\n    const doc = documents.get(params.textDocument.uri);\n    if (!doc || cancelled(token)) return emptySemanticTokens();\n    if (tooLarge(doc)) return emptySemanticTokens();\n    try {\n      const tokens = await withTimeout(Promise.resolve(createSemanticTokens(doc)), timeoutFor(\"semanticTokens\"));\n      metric(\"semanticTokens\", start, doc.uri, tokens.data.length / 5);\n      recordSuccess();\n      return tokens;\n    } catch (e) {\n      metric(\"semanticTokens\", start, doc?.uri ?? \"unknown\", undefined, e);\n      recordFailure();\n      logErr(\"semanticTokens\", e);\n      return emptySemanticTokens();\n    }\n  });\n});\n\n/* -------------------------------- Diagnostics ----------------------------- */\nconst lintTimers = new Map<string, NodeJS.Timeout>();\nconst lintQueue: string[] = [];\nconst lintQueued = new Set<string>();\nlet lintWorkerRunning = false;\n\nfunction runLint(doc: TextDocument): void {\n  const t0 = now();\n  try {\n    if (!featureEnabled(\"lint\")) return;\n    if (isBreakerActive()) return;\n    if (tooLarge(doc)) { void connection.sendDiagnostics({ uri: doc.uri, diagnostics: [] }); return; }\n    const text = doc.getText();\n    const uri = doc.uri;\n    const diags = lintToPublishable(text, uri, globalSettings.lint) ?? [];\n    void connection.sendDiagnostics({ uri, diagnostics: diags });\n    metric(\"lint\", t0, uri, diags.length);\n  } catch (e) {\n    metric(\"lint\", t0, doc?.uri ?? \"unknown\", undefined, e);\n    logErr(\"lint\", e);\n  }\n}\n\nfunction scheduleLint(doc: TextDocument): void {\n  if (!featureEnabled(\"lint\")) return;\n  const key = doc.uri;\n  const delay = Math.max(0, globalSettings.lintDebounceMs | 0);\n  const prev = lintTimers.get(key);\n  if (prev) clearTimeout(prev);\n  lintTimers.set(key, setTimeout(() => enqueueLint(key), delay));\n}\n\nfunction safeIndexDocument(doc: TextDocument): void {\n  if (memoryExceeded()) {\n    connection.console.warn(\"[index] skipped due to memory quota\");\n    return;\n  }\n  indexWorkspaceDocument(doc);\n}\n\nfunction enqueueLint(uri: string): void {\n  if (lintQueued.has(uri)) return;\n  lintQueued.add(uri);\n  lintQueue.push(uri);\n  void processLintQueue();\n}\n\nfunction processLintQueue(): void {\n  if (lintWorkerRunning) return;\n  lintWorkerRunning = true;\n  try {\n    while (lintQueue.length > 0) {\n      const uri = lintQueue.shift()!;\n      lintQueued.delete(uri);\n      const doc = documents.get(uri);\n      if (!doc) continue;\n      runLint(doc);\n    }\n  } finally {\n    lintWorkerRunning = false;\n  }\n}\n\n/* --------------------------------- Events -------------------------------- */\n\ndocuments.onDidOpen((e) => { safeIndexDocument(e.document); scheduleLint(e.document); });\ndocuments.onDidChangeContent((e) => { safeIndexDocument(e.document); scheduleLint(e.document); });\ndocuments.onDidClose((e) => {\n  removeWorkspaceDocument(e.document.uri);\n  void connection.sendDiagnostics({ uri: e.document.uri, diagnostics: [] });\n  const timer = lintTimers.get(e.document.uri);\n  if (timer) clearTimeout(timer);\n  lintTimers.delete(e.document.uri);\n});\n\n/* --------------------------------- Launch -------------------------------- */\n\ndocuments.listen(connection);\nconnection.listen();\n\n/* --------------------------------- Utils --------------------------------- */\n\nfunction now(): number {\n  if (typeof process !== \"undefined\" && typeof process.hrtime === \"function\") {\n    const [sec, nanosec] = process.hrtime();\n    return sec * 1000 + nanosec / 1e6;\n  }\n  return Date.now();\n}\n\nfunction metric(what: string, startMs: number, uri: string, n?: number, err?: unknown) {\n  const elapsed = now() - startMs;\n  recordMetric(what, elapsed, uri, n, err);\n}\n\nfunction recordMetric(what: string, elapsed: number, uri: string, n?: number, err?: unknown) {\n  const entry = metricStore.get(what) ?? {\n    count: 0,\n    totalMs: 0,\n    maxMs: 0,\n    lastMs: 0,\n    lastAt: 0,\n    lastUri: \"\",\n    errorCount: 0,\n    samples: [],\n  };\n  entry.count += 1;\n  entry.totalMs += elapsed;\n  entry.maxMs = Math.max(entry.maxMs, elapsed);\n  entry.lastMs = elapsed;\n  entry.lastAt = Date.now();\n  entry.lastUri = uri;\n  entry.lastCount = typeof n === \"number\" ? n : undefined;\n  if (err) {\n    entry.errorCount += 1;\n    entry.lastError = formatError(err);\n  }\n  entry.samples.push(elapsed);\n  if (entry.samples.length > 1000) entry.samples.shift();\n  metricStore.set(what, entry);\n\n  if (globalSettings.trace === \"verbose\") {\n    if (Math.random() < (globalSettings.traceSampleRate || 0)) {\n      connection.console.log(\n        `[metric] ${what} ${elapsed.toFixed(1)}ms uri=${uri}${typeof n === \"number\" ? ` n=${n}` : \"\"}`\n      );\n    }\n  }\n}\n\nconst errorRateLimit = new Map<string, number>();\nconst ERROR_LOG_INTERVAL_MS = 2000;\n\nfunction formatError(err: unknown): string {\n  if (err instanceof Error) return `${err.name}: ${err.message}`;\n  if (typeof err === \"string\") return err;\n  try {\n    return JSON.stringify(err);\n  } catch {\n    return \"[unknown error]\";\n  }\n}\n\nfunction logErr(ctx: string, err: unknown) {\n  const msg = formatError(err);\n  const nowTs = Date.now();\n  const last = errorRateLimit.get(ctx) ?? 0;\n  if (nowTs - last < ERROR_LOG_INTERVAL_MS) return;\n  errorRateLimit.set(ctx, nowTs);\n  if (globalSettings.trace === \"verbose\" && err instanceof Error && err.stack) {\n    connection.console.error(`[${ctx}] ${msg}\\n${err.stack}`);\n  } else {\n    connection.console.error(`[${ctx}] ${msg}`);\n  }\n}\n\nfunction clampNumber(value: number, min: number, max: number, fallback: number): number {\n  if (!Number.isFinite(value)) return fallback;\n  return Math.min(max, Math.max(min, value));\n}\n\nfunction percentile(samples: number[], p: number): number {\n  if (!samples.length) return 0;\n  const sorted = [...samples].sort((a, b) => a - b);\n  const idx = Math.min(sorted.length - 1, Math.max(0, Math.ceil((p / 100) * sorted.length) - 1));\n  return sorted[idx];\n}\n"]}