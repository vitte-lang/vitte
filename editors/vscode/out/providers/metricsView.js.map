{"version":3,"file":"metricsView.js","sourceRoot":"","sources":["../../src/providers/metricsView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoFA,kDAOC;AA3FD,+CAAiC;AAWjC,MAAM,oBAAoB;IAOxB,YAA6B,SAA2C;QAA3C,cAAS,GAAT,SAAS,CAAkC;QANvD,yBAAoB,GAAG,IAAI,MAAM,CAAC,YAAY,EAAyB,CAAC;QAChF,wBAAmB,GAAG,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC;QAEvD,YAAO,GAAwB,EAAE,CAAC;IAGiC,CAAC;IAE5E,OAAO;QACL,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClB,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC7B,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,KAAK;QACH,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC;QACpB,IAAI,CAAC,QAAQ,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;IACpE,CAAC;IAED,KAAK,CAAC,OAAO;QACX,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;YAChC,IAAI,CAAC,MAAM,EAAE,CAAC;gBACZ,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;YACpB,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,OAAO,GAAG,MAAM,MAAM,CAAC,WAAW,CAAsB,eAAe,CAAC,CAAC;YAChF,CAAC;QACH,CAAC;QAAC,MAAM,CAAC;YACP,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QACpB,CAAC;QACD,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC;IACnC,CAAC;IAED,WAAW,CAAC,OAAuB;QACjC,IAAI,aAAa,CAAC,OAAO,CAAC,EAAE,CAAC;YAC3B,MAAM,IAAI,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,MAAM,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;YACxF,IAAI,CAAC,QAAQ,GAAG,IAAI,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;YAC7C,IAAI,CAAC,YAAY,GAAG,aAAa,CAAC;YAClC,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,GAAG,GAAG,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACzC,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACvC,MAAM,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACrC,MAAM,IAAI,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,OAAO,CAAC,IAAI,EAAE,EAAE,MAAM,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;QAC1F,IAAI,CAAC,WAAW,GAAG,GAAG,GAAG,YAAY,OAAO,CAAC,KAAK,IAAI,CAAC;QACvD,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC;QAClF,MAAM,SAAS,GAAG,OAAO,OAAO,CAAC,SAAS,KAAK,QAAQ,CAAC,CAAC,CAAC,UAAU,OAAO,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;QAC7F,IAAI,CAAC,OAAO,GAAG;YACb,YAAY,GAAG,KAAK;YACpB,SAAS,IAAI,KAAK;YAClB,QAAQ,GAAG,KAAK;YAChB,UAAU,OAAO,CAAC,KAAK,EAAE;YACzB,aAAa,OAAO,CAAC,OAAO,IAAI,KAAK,EAAE;YACvC,YAAY,IAAI,IAAI,SAAS,EAAE,CAAC,IAAI,EAAE;SACvC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACb,IAAI,CAAC,YAAY,GAAG,aAAa,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;IAED,WAAW;QACT,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC9B,OAAO,CAAC,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,0BAA0B,EAAE,CAAC,CAAC;QACtE,CAAC;QACD,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;CACF;AAED,SAAS,aAAa,CAAC,IAAoB;IACzC,OAAQ,IAAwB,CAAC,WAAW,KAAK,IAAI,CAAC;AACxD,CAAC;AAED,SAAgB,mBAAmB,CAAC,OAAgC,EAAE,SAA2C;IAC/G,MAAM,QAAQ,GAAG,IAAI,oBAAoB,CAAC,SAAS,CAAC,CAAC;IACrD,MAAM,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,cAAc,EAAE,EAAE,gBAAgB,EAAE,QAAQ,EAAE,CAAC,CAAC;IAC9F,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACrC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACrC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,uBAAuB,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;IAC/G,QAAQ,CAAC,KAAK,EAAE,CAAC;AACnB,CAAC","sourcesContent":["import * as vscode from \"vscode\";\nimport type { LanguageClient } from \"vscode-languageclient/node\";\nimport type { ServerMetricEntry } from \"../types/metrics\";\n\ntype MetricTreeNode = ServerMetricEntry | PlaceholderNode;\n\ninterface PlaceholderNode {\n  placeholder: true;\n  message: string;\n}\n\nclass VitteMetricsProvider implements vscode.TreeDataProvider<MetricTreeNode>, vscode.Disposable {\n  private readonly _onDidChangeTreeData = new vscode.EventEmitter<MetricTreeNode | void>();\n  readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n  private metrics: ServerMetricEntry[] = [];\n  private interval: NodeJS.Timeout | undefined;\n\n  constructor(private readonly getClient: () => LanguageClient | undefined) {}\n\n  dispose(): void {\n    if (this.interval) {\n      clearInterval(this.interval);\n      this.interval = undefined;\n    }\n  }\n\n  start(): void {\n    void this.refresh();\n    this.interval = setInterval(() => { void this.refresh(); }, 5000);\n  }\n\n  async refresh(): Promise<void> {\n    try {\n      const client = this.getClient();\n      if (!client) {\n        this.metrics = [];\n      } else {\n        this.metrics = await client.sendRequest<ServerMetricEntry[]>(\"vitte/metrics\");\n      }\n    } catch {\n      this.metrics = [];\n    }\n    this._onDidChangeTreeData.fire();\n  }\n\n  getTreeItem(element: MetricTreeNode): vscode.TreeItem {\n    if (isPlaceholder(element)) {\n      const item = new vscode.TreeItem(element.message, vscode.TreeItemCollapsibleState.None);\n      item.iconPath = new vscode.ThemeIcon(\"info\");\n      item.contextValue = \"placeholder\";\n      return item;\n    }\n    const avg = element.averageMs.toFixed(2);\n    const last = element.lastMs.toFixed(2);\n    const max = element.maxMs.toFixed(2);\n    const item = new vscode.TreeItem(`${element.name}`, vscode.TreeItemCollapsibleState.None);\n    item.description = `${avg} ms avg (${element.count}×)`;\n    const when = element.lastAt ? new Date(element.lastAt).toLocaleTimeString() : \"—\";\n    const countInfo = typeof element.lastCount === \"number\" ? `last n=${element.lastCount}` : \"\";\n    item.tooltip = [\n      `Average: ${avg} ms`,\n      `Last: ${last} ms`,\n      `Max: ${max} ms`,\n      `Calls: ${element.count}`,\n      `Last URI: ${element.lastUri || \"n/a\"}`,\n      `Last at: ${when} ${countInfo}`.trim(),\n    ].join(\"\\n\");\n    item.contextValue = \"metricEntry\";\n    return item;\n  }\n\n  getChildren(): MetricTreeNode[] | Thenable<MetricTreeNode[]> {\n    if (this.metrics.length === 0) {\n      return [{ placeholder: true, message: \"No metrics captured yet.\" }];\n    }\n    return this.metrics;\n  }\n}\n\nfunction isPlaceholder(node: MetricTreeNode): node is PlaceholderNode {\n  return (node as PlaceholderNode).placeholder === true;\n}\n\nexport function registerMetricsView(context: vscode.ExtensionContext, getClient: () => LanguageClient | undefined): void {\n  const provider = new VitteMetricsProvider(getClient);\n  const treeView = vscode.window.createTreeView(\"vitteMetrics\", { treeDataProvider: provider });\n  context.subscriptions.push(treeView);\n  context.subscriptions.push(provider);\n  context.subscriptions.push(vscode.commands.registerCommand(\"vitte.metrics.refresh\", () => provider.refresh()));\n  provider.start();\n}\n"]}