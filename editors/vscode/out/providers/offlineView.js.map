{"version":3,"file":"offlineView.js","sourceRoot":"","sources":["../../src/providers/offlineView.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"node:path\";\nimport * as os from \"node:os\";\nimport * as fs from \"node:fs\";\nimport * as vscode from \"vscode\";\n\ninterface OfflineNode {\n  label: string;\n  description?: string;\n  icon?: vscode.ThemeIcon;\n  command?: vscode.Command;\n}\n\nclass OfflineViewProvider implements vscode.TreeDataProvider<OfflineNode> {\n  private readonly _onDidChangeTreeData = new vscode.EventEmitter<OfflineNode | void>();\n  readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n  constructor(\n    private readonly getReason: () => string | undefined,\n    private readonly getOutput: () => vscode.OutputChannel,\n    private readonly getSince?: () => string,\n    private readonly getSummary?: () => string | undefined\n  ) {}\n\n  dispose(): void {\n    this._onDidChangeTreeData.dispose();\n  }\n\n  refresh(): void {\n    this._onDidChangeTreeData.fire();\n  }\n\n  getTreeItem(element: OfflineNode): vscode.TreeItem {\n    const item = new vscode.TreeItem(element.label, vscode.TreeItemCollapsibleState.None);\n    if (element.description) item.description = element.description;\n    if (element.icon) item.iconPath = element.icon;\n    if (element.command) item.command = element.command;\n    return item;\n  }\n\n  getChildren(): OfflineNode[] {\n    const reason = this.getReason() ?? \"Offline mode is enabled.\";\n    const since = this.getSince?.() ?? \"unknown\";\n    const summary = this.getSummary?.();\n    return [\n      { label: \"Server Offline\", description: reason, icon: new vscode.ThemeIcon(\"circle-slash\") },\n      { label: \"Offline Since\", description: since, icon: new vscode.ThemeIcon(\"history\") },\n      summary ? { label: \"Local Diagnostics\", description: summary, icon: new vscode.ThemeIcon(\"warning\") } : undefined,\n      { label: \"Explain Offline\", icon: new vscode.ThemeIcon(\"question\"), command: { command: \"vitte.offline.explain\", title: \"Explain Offline\" } },\n      { label: \"Copy Offline Report\", icon: new vscode.ThemeIcon(\"copy\"), command: { command: \"vitte.offline.copyReport\", title: \"Copy Offline Report\" } },\n      { label: \"Open Settings\", icon: new vscode.ThemeIcon(\"settings-gear\"), command: { command: \"workbench.action.openSettings\", title: \"Open Settings\", arguments: [\"vitte.server\"] } },\n      { label: \"Open Offline Log\", icon: new vscode.ThemeIcon(\"file-text\"), command: { command: \"vitte.offline.openLog\", title: \"Open Offline Log\" } },\n      { label: \"Open Server Log\", icon: new vscode.ThemeIcon(\"output\"), command: { command: \"vitte.showServerLog\", title: \"Open Server Log\" } },\n    ].filter(Boolean) as OfflineNode[];\n  }\n\n  getOfflineLogPath(): string {\n    const folder = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n    const base = folder ?? os.tmpdir();\n    return path.join(base, \".vitte\", \"offline.log\");\n  }\n\n  async openOfflineLog(): Promise<void> {\n    const filePath = this.getOfflineLogPath();\n    try {\n      if (!fs.existsSync(filePath)) {\n        await fs.promises.mkdir(path.dirname(filePath), { recursive: true });\n        await fs.promises.writeFile(filePath, \"\", \"utf8\");\n      }\n      const uri = vscode.Uri.file(filePath);\n      await vscode.commands.executeCommand(\"vscode.open\", uri);\n    } catch {\n      const output = this.getOutput();\n      output.appendLine(`[offline] Unable to open offline log at ${filePath}`);\n      output.show(true);\n    }\n  }\n}\n\nexport function registerOfflineView(\n  context: vscode.ExtensionContext,\n  getReason: () => string | undefined,\n  getOutput: () => vscode.OutputChannel,\n  getSince?: () => string,\n  getSummary?: () => string | undefined\n): void {\n  const provider = new OfflineViewProvider(getReason, getOutput, getSince, getSummary);\n  const tree = vscode.window.createTreeView(\"vitteOffline\", { treeDataProvider: provider });\n  context.subscriptions.push(tree);\n  context.subscriptions.push(provider);\n  context.subscriptions.push(vscode.commands.registerCommand(\"vitte.offline.openLog\", () => provider.openOfflineLog()));\n  context.subscriptions.push(vscode.commands.registerCommand(\"vitte.offline.refresh\", () => provider.refresh()));\n}\n"]}