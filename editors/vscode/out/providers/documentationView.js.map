{"version":3,"file":"documentationView.js","sourceRoot":"","sources":["../../src/providers/documentationView.ts"],"names":[],"mappings":"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","sourcesContent":["import * as vscode from \"vscode\";\nimport { DOC_SECTIONS, makeDocUrl } from \"./documentationChapters\";\n\ninterface DocumentationViewOptions {\n  title: string;\n  url: string;\n}\n\nclass DocumentationViewProvider implements vscode.WebviewViewProvider {\n  constructor(\n    private readonly options: DocumentationViewOptions\n  ) {}\n\n  resolveWebviewView(webviewView: vscode.WebviewView): void {\n    webviewView.webview.options = {\n      enableScripts: true,\n    };\n    webviewView.webview.html = this.getHtml(webviewView.webview);\n    webviewView.webview.onDidReceiveMessage((message) => {\n      if (!message || typeof message !== \"object\") return;\n      const type = (message as { type?: string }).type;\n      if (type !== \"openExternal\") return;\n      void vscode.env.openExternal(vscode.Uri.parse(this.options.url));\n    });\n  }\n\n  private getHtml(webview: vscode.Webview): string {\n    const nonce = String(Date.now());\n    const freshUrl = withCacheBuster(this.options.url);\n    const csp = [\n      \"default-src 'none'\",\n      \"style-src 'unsafe-inline'\",\n      `script-src 'nonce-${nonce}'`,\n      \"img-src https: data:\",\n      `frame-src ${freshUrl} https://vitte.netlify.app`,\n      `connect-src ${freshUrl} https://vitte.netlify.app`\n    ].join(\"; \");\n    const safeTitle = escapeHtml(this.options.title);\n    const safeUrl = escapeHtml(freshUrl);\n    const chapters = DOC_SECTIONS\n      .map((section) => `<optgroup label=\"${escapeHtml(section.title)}\">${\n        section.chapters.map((chapter) => {\n          const url = makeDocUrl(chapter.path);\n          return `<option value=\"${escapeHtml(url)}\">${escapeHtml(chapter.title)}</option>`;\n        }).join(\"\")\n      }</optgroup>`)\n      .join(\"\");\n    return `<!doctype html>\n<html lang=\"fr\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta http-equiv=\"Content-Security-Policy\" content=\"${csp}\" />\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n  <style>\n    :root { color-scheme: light dark; }\n    body { margin: 0; font-family: var(--vscode-font-family); background: var(--vscode-editor-background); color: var(--vscode-editor-foreground); }\n    .bar { display: flex; align-items: center; gap: 8px; padding: 8px; border-bottom: 1px solid var(--vscode-panel-border); flex-wrap: wrap; }\n    .btn { cursor: pointer; border: 1px solid var(--vscode-button-border, transparent); background: var(--vscode-button-background); color: var(--vscode-button-foreground); padding: 4px 8px; border-radius: 4px; }\n    .label { font-size: 12px; opacity: .85; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n    iframe { width: 100%; height: calc(100vh - 42px); border: 0; }\n  </style>\n</head>\n<body>\n  <div class=\"bar\">\n    <button class=\"btn\" id=\"openExternal\" type=\"button\">Open in browser</button>\n    <select id=\"chapters\" class=\"btn\" aria-label=\"Sommaire\">${chapters}</select>\n    <button class=\"btn\" id=\"goChapter\" type=\"button\">Open chapter</button>\n    <div class=\"label\">${safeTitle} Â· ${safeUrl}</div>\n  </div>\n  <iframe id=\"docsFrame\" src=\"${safeUrl}\" title=\"${safeTitle}\" loading=\"lazy\" referrerpolicy=\"no-referrer\"></iframe>\n  <script nonce=\"${nonce}\">\n    const vscode = acquireVsCodeApi();\n    const frame = document.getElementById(\"docsFrame\");\n    const chapters = document.getElementById(\"chapters\");\n    const openChapter = () => {\n      if (!frame || !chapters || !chapters.value) return;\n      frame.src = chapters.value;\n    };\n    document.getElementById(\"openExternal\")?.addEventListener(\"click\", () => {\n      vscode.postMessage({ type: \"openExternal\" });\n    });\n    document.getElementById(\"goChapter\")?.addEventListener(\"click\", openChapter);\n    chapters?.addEventListener(\"change\", openChapter);\n  </script>\n</body>\n</html>`;\n  }\n}\n\nfunction escapeHtml(value: string): string {\n  return value\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction withCacheBuster(url: string): string {\n  try {\n    const parsed = new URL(url);\n    parsed.searchParams.set(\"from\", \"vscode\");\n    parsed.searchParams.set(\"ts\", String(Date.now()));\n    return parsed.toString();\n  } catch {\n    return url;\n  }\n}\n\nexport function registerDocumentationView(\n  context: vscode.ExtensionContext,\n  viewId: string,\n  title: string,\n  url = \"https://vitte.netlify.app\"\n): void {\n  const provider = new DocumentationViewProvider({ title, url });\n  context.subscriptions.push(\n    vscode.window.registerWebviewViewProvider(viewId, provider, { webviewOptions: { retainContextWhenHidden: true } })\n  );\n}\n"]}