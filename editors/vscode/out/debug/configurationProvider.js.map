{"version":3,"file":"configurationProvider.js","sourceRoot":"","sources":["../../src/debug/configurationProvider.ts"],"names":[],"mappings":"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","sourcesContent":["import * as vscode from 'vscode';\nimport * as path from 'path';\n\ninterface VitteDebugSettings {\n  program?: string;\n  args?: string[];\n  cwd?: string;\n  trace?: boolean;\n  sourceMaps?: boolean;\n  env?: Record<string, string>;\n}\n\ninterface VitteDebugJson {\n  debug?: VitteDebugSettings;\n  toolchain?: { root?: string; runtime?: string };\n}\n\n/** Read and parse JSON file into object. */\nasync function readJsonFile<T = unknown>(uri: vscode.Uri): Promise<T | undefined> {\n  try {\n    const doc = await vscode.workspace.openTextDocument(uri);\n    return JSON.parse(doc.getText()) as T;\n  } catch {\n    return undefined;\n  }\n}\n\n/** Try multiple known config locations, first hit wins then shallow-merge. */\nasync function readVitteProjectConfig(): Promise<VitteDebugJson> {\n  const results: VitteDebugJson[] = [];\n\n  // 1) vitte.config.json at workspace root\n  const rootCfg = await vscode.workspace.findFiles('vitte.config.json', '**/node_modules/**', 1);\n  const rootUri = rootCfg[0];\n  if (rootUri) {\n    const j = await readJsonFile<VitteDebugJson>(rootUri);\n    if (j) results.push(j);\n  }\n\n  // 2) .vitte/config.json fallback\n  const hiddenCfg = await vscode.workspace.findFiles('.vitte/config.json', '**/node_modules/**', 1);\n  const hiddenUri = hiddenCfg[0];\n  if (hiddenUri) {\n    const j = await readJsonFile<VitteDebugJson>(hiddenUri);\n    if (j) results.push(j);\n  }\n\n  // 3) package.json { vitte: { debug: {...} } }\n  const pkg = await vscode.workspace.findFiles('package.json', '**/node_modules/**', 1);\n  const pkgUri = pkg[0];\n  if (pkgUri) {\n    const pjson = await readJsonFile<Record<string, unknown>>(pkgUri);\n    const vitteSection = pjson?.vitte;\n    if (vitteSection && typeof vitteSection === 'object') {\n      const pick: VitteDebugJson = {};\n      const debugSection = (vitteSection as Record<string, unknown>).debug;\n      const toolchainSection = (vitteSection as Record<string, unknown>).toolchain;\n      if (debugSection && typeof debugSection === 'object') pick.debug = { ...(debugSection as VitteDebugSettings) };\n      if (toolchainSection && typeof toolchainSection === 'object') pick.toolchain = { ...(toolchainSection as NonNullable<VitteDebugJson['toolchain']>) };\n      results.push(pick);\n    }\n  }\n\n  // Merge shallowly from first to last, later wins\n  const merged: VitteDebugJson = {};\n  for (const r of results) {\n    if (r.toolchain) merged.toolchain = { ...(merged.toolchain ?? {}), ...r.toolchain };\n    if (r.debug) merged.debug = { ...(merged.debug ?? {}), ...r.debug };\n  }\n  return merged;\n}\n\nfunction ensureWorkspaceFolder(): string | undefined {\n  return vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n}\n\n/** Expand VS Code variables and env vars in strings. */\nfunction expand(str: string, fileUri?: vscode.Uri): string {\n  const wf = ensureWorkspaceFolder() ?? '';\n  const active = fileUri ?? vscode.window.activeTextEditor?.document.uri;\n  const filePath = active?.fsPath ?? '';\n  const fileDir = filePath ? path.dirname(filePath) : '';\n  const env = process.env;\n  const table: Record<string, string> = {\n    workspaceFolder: wf,\n    file: filePath,\n    fileDirname: fileDir,\n  };\n  return str.replace(/\\$\\{(env:)?([^}]+)}/g, function (_m: string, envPrefix: string | undefined, key: string): string {\n    const k = String(key);\n    if (envPrefix) return env[k] ?? '';\n    return table[k] ?? '';\n  });\n}\n\nfunction coerceArgs(v: unknown): string[] | undefined {\n  if (Array.isArray(v)) return v.filter((x): x is string => typeof x === 'string' && x.length > 0);\n  if (typeof v === 'string' && v.length) return [v];\n  return undefined;\n}\n\nfunction sanitizeEnv(obj: unknown): Record<string, string> {\n  const out: Record<string, string> = {};\n  if (obj && typeof obj === 'object') {\n    for (const [k, v] of Object.entries(obj as Record<string, unknown>)) {\n      if (typeof v === 'string') out[k] = v;\n    }\n  }\n  return out;\n}\n\nfunction resolveRuntimePath(cfg: vscode.WorkspaceConfiguration, project: VitteDebugJson): string {\n  // Priority: launch.json > vitte.debug.program (settings) > project.debug.program > toolchain.runtime > default\n  const setProgram = cfg.get<string>('debug.program');\n  if (setProgram?.trim()) return setProgram;\n\n  const projectProg = project.debug?.program ?? project.toolchain?.runtime;\n  let candidate = projectProg ?? 'vitte-runtime';\n\n  // Prepend toolchain.root when relative\n  const toolchainRoot = cfg.get<string>('toolchain.root') ?? project.toolchain?.root ?? cfg.get<string>('toolchainPath');\n  if (toolchainRoot && candidate && !path.isAbsolute(candidate)) {\n    candidate = path.join(toolchainRoot, candidate);\n  }\n  return candidate;\n}\n\n/**\n * Provides initial debug configurations and resolves them using Vitte settings and project config files.\n */\nclass VitteDebugConfigurationProvider implements vscode.DebugConfigurationProvider {\n  provideDebugConfigurations(_folder: vscode.WorkspaceFolder | undefined): vscode.ProviderResult<vscode.DebugConfiguration[]> {\n    const workspaceFolder = ensureWorkspaceFolder() ?? '${workspaceFolder}';\n    return [\n      {\n        name: 'Vitte: Launch current file',\n        type: 'vitte',\n        request: 'launch',\n        program: 'vitte-runtime',\n        args: ['run', '${file}'],\n        cwd: workspaceFolder\n      },\n      {\n        name: 'Vitte: Launch project entry',\n        type: 'vitte',\n        request: 'launch',\n        program: 'vitte-runtime',\n        args: ['run'],\n        cwd: workspaceFolder\n      },\n      {\n        name: 'Vitte: Launch with args…',\n        type: 'vitte',\n        request: 'launch',\n        program: 'vitte-runtime',\n        args: [],\n        cwd: workspaceFolder\n      }\n    ];\n  }\n\n  async resolveDebugConfiguration(folder: vscode.WorkspaceFolder | undefined, config: vscode.DebugConfiguration): Promise<vscode.DebugConfiguration | null | undefined> {\n    const settings = vscode.workspace.getConfiguration('vitte');\n    const project = await readVitteProjectConfig();\n\n    const workspaceFolder = folder?.uri.fsPath ?? ensureWorkspaceFolder() ?? process.cwd();\n    const activeUri = vscode.window.activeTextEditor?.document.uri;\n\n    const configRecord = config as Record<string, unknown>;\n    const configEnvValue = configRecord.env;\n    const configEnvObject = (typeof configEnvValue === 'object' && configEnvValue) ? configEnvValue : undefined;\n\n    const mergedEnvRaw: unknown = {\n      ...(project.debug?.env ?? {}),\n      ...(configEnvObject as Record<string, unknown> | undefined ?? {}),\n    };\n    const mergedEnv = sanitizeEnv(mergedEnvRaw);\n\n    const base: vscode.DebugConfiguration = {\n      type: 'vitte',\n      request: 'launch',\n      name: typeof configRecord.name === 'string' && configRecord.name.length > 0 ? configRecord.name : 'Vitte: Launch',\n      program: resolveRuntimePath(settings, project),\n      args: coerceArgs(configRecord.args) ?? coerceArgs(project.debug?.args) ?? ['run'],\n      cwd: (() => {\n        const cfgCwd = configRecord.cwd;\n        if (typeof cfgCwd === 'string' && cfgCwd.length > 0) return cfgCwd;\n        if (typeof project.debug?.cwd === 'string' && project.debug.cwd.length > 0) return project.debug.cwd;\n        return workspaceFolder;\n      })(),\n      env: mergedEnv,\n    };\n\n    // Optional flags\n    const configTraceRaw = configRecord.trace;\n    if (typeof project.debug?.trace === 'boolean' && typeof configTraceRaw !== 'boolean') {\n      base.trace = project.debug.trace;\n    }\n    const configSourceMapsRaw = configRecord.sourceMaps;\n    if (typeof project.debug?.sourceMaps === 'boolean' && typeof configSourceMapsRaw !== 'boolean') {\n      base.sourceMaps = project.debug.sourceMaps;\n    }\n\n    // VS Code variable expansion\n    const programValue = typeof base.program === 'string' ? base.program : String(base.program ?? '');\n    base.program = expand(programValue, activeUri);\n\n    const cwdValue = typeof base.cwd === 'string' ? base.cwd : String(base.cwd ?? workspaceFolder);\n    base.cwd = expand(cwdValue, activeUri);\n\n    const argsValue = Array.isArray(base.args) ? base.args : [];\n    base.args = argsValue.map((s) => expand(String(s), activeUri));\n\n    if (base.env && typeof base.env === 'object') {\n      const env: Record<string, string> = {};\n      for (const [k, v] of Object.entries(base.env as Record<string, unknown>)) {\n        if (typeof v === 'string') env[k] = expand(v, activeUri);\n      }\n      base.env = env;\n    }\n\n    // Sanity\n    if (!base.program || typeof base.program !== 'string') {\n      void vscode.window.showErrorMessage('Vitte: aucun binaire runtime configuré. Configurez \"vitte.debug.program\" ou vitte.config.json > debug.program.');\n      return undefined;\n    }\n\n    return base;\n  }\n}\n\nexport function registerDebugConfigurationProvider(ctx: vscode.ExtensionContext) {\n  const provider = new VitteDebugConfigurationProvider();\n  ctx.subscriptions.push(vscode.debug.registerDebugConfigurationProvider('vitte', provider));\n}\n"]}