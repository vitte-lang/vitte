{"version":3,"file":"testTasks.js","sourceRoot":"","sources":["../../src/tasks/testTasks.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,0CAkBC;AAGD,sCAgBC;AAzDD,+CAAiC;AACjC,2CAA6B;AAC7B,uCAAyB;AAEzB,sCAAsC;AACtC,SAAS,YAAY,CAAC,CAAqB,EAAE,QAAgB;IAC3D,OAAO,CAAC,OAAO,CAAC,KAAK,QAAQ,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;AAChE,CAAC;AACD,SAAS,YAAY,CAAC,IAA4B;IAChD,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAe,EAAE,CAAC,OAAO,CAAC,KAAK,QAAQ,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AAChF,CAAC;AAED,4DAA4D;AAC5D,SAAS,cAAc,CAAC,IAAgB,EAAE,GAAG,KAAe;IAC1D,MAAM,MAAM,GAAG,MAAM,CAAC,GAA4F,CAAC;IACnH,IAAI,OAAO,MAAM,CAAC,QAAQ,KAAK,UAAU;QAAE,OAAO,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,KAAK,CAAC,CAAC;IAClF,OAAO,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC;AAC3D,CAAC;AAED,4CAA4C;AAC5C,SAAgB,eAAe,CAAC,UAAmB;IACjD,MAAM,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;IAEvD,2EAA2E;IAC3E,MAAM,OAAO,GAAG,YAAY,CAAC,GAAG,CAAC,GAAG,CAAS,cAAc,CAAC,IAAI,GAAG,CAAC,GAAG,CAAS,eAAe,CAAC,EAAE,OAAO,CAAC,CAAC;IAE3G,8BAA8B;IAC9B,MAAM,KAAK,GAAG,YAAY,CAAC;QACzB,GAAG,CAAC,GAAG,CAAS,WAAW,CAAC;KAC7B,CAAC,CAAC;IAEH,4CAA4C;IAC5C,MAAM,KAAK,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAChC,IAAI,UAAU;QAAE,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACvC,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,CAAC;IAErB,0EAA0E;IAC1E,OAAO,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACzB,CAAC;AAED,8DAA8D;AAC9D,SAAgB,aAAa;IAC3B,MAAM,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;IAEvD,8BAA8B;IAC9B,MAAM,QAAQ,GAAG,GAAG,CAAC,GAAG,CAAS,gBAAgB,CAAC,CAAC;IACnD,IAAI,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC;QAAE,OAAO,QAAQ,CAAC;IAErD,kDAAkD;IAClD,MAAM,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC,CAAC;IAClD,IAAI,CAAC,EAAE;QAAE,OAAO,SAAS,CAAC;IAC1B,MAAM,GAAG,GAAG,cAAc,CAAC,EAAE,CAAC,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,OAAO,CAAC,CAAC;IACjE,MAAM,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC;IAErB,0CAA0C;IAC1C,IAAI,CAAC;QAAC,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAAC,CAAC;IAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC;IACpE,OAAO,CAAC,CAAC;AACX,CAAC","sourcesContent":["import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\n\n// Tiny helpers (strict/optional-safe)\nfunction ensureString(x: string | undefined, fallback: string): string {\n  return (typeof x === 'string' && x.length > 0) ? x : fallback;\n}\nfunction sanitizeArgs(args: (string | undefined)[]): string[] {\n  return args.filter((a): a is string => typeof a === 'string' && a.length > 0);\n}\n\n// Compat: Uri.joinPath may not exist on older @types/vscode\nfunction joinPathCompat(base: vscode.Uri, ...parts: string[]): vscode.Uri {\n  const anyUri = vscode.Uri as unknown as { joinPath?: (base: vscode.Uri, ...pathSegments: string[]) => vscode.Uri };\n  if (typeof anyUri.joinPath === 'function') return anyUri.joinPath(base, ...parts);\n  return vscode.Uri.file(path.join(base.fsPath, ...parts));\n}\n\n/** Build the shell command to run tests. */\nexport function testCommandLine(withReport: boolean): string {\n  const cfg = vscode.workspace.getConfiguration('vitte');\n\n  // Prefer explicit runtime if configured (string), else fallback to 'vitte'\n  const runtime = ensureString(cfg.get<string>('runtime.path') ?? cfg.get<string>('debug.program'), 'vitte');\n\n  // Optional args from settings\n  const extra = sanitizeArgs([\n    cfg.get<string>('test.args'),\n  ]);\n\n  // Compose: `vitte test [--report] ...extra`\n  const parts = [runtime, 'test'];\n  if (withReport) parts.push('--report');\n  parts.push(...extra);\n\n  // Return a single shell string (ShellExecution will pass it to the shell)\n  return parts.join(' ');\n}\n\n/** Directory where test reports are written (best-effort). */\nexport function testReportDir(): string | undefined {\n  const cfg = vscode.workspace.getConfiguration('vitte');\n\n  // Allow override via settings\n  const override = cfg.get<string>('test.reportDir');\n  if (override && override.length > 0) return override;\n\n  // Default: <first-workspace>/.vitte/reports/tests\n  const wf = vscode.workspace.workspaceFolders?.[0];\n  if (!wf) return undefined;\n  const uri = joinPathCompat(wf.uri, '.vitte', 'reports', 'tests');\n  const p = uri.fsPath;\n\n  // Best-effort ensure the directory exists\n  try { fs.mkdirSync(p, { recursive: true }); } catch { /* ignore */ }\n  return p;\n}\n"]}