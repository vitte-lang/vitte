{"version":3,"file":"extension.test.js","sourceRoot":"","sources":["../../../src/test/suite/extension.test.ts"],"names":[],"mappings":"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","sourcesContent":["import * as assert from \"node:assert/strict\";\nimport * as fs from \"node:fs\";\nimport * as path from \"node:path\";\nimport * as vscode from \"vscode\";\n\nconst EXTENSION_ID = \"VitteStudio.vitte-studio\";\n\ninterface ExtensionTestApi {\n  getStatusText(): string;\n  getStatusTooltip(): string;\n  getClientState(): unknown;\n  runAction(action: string): Promise<void>;\n  resolveServerModuleForTest(ctx: Pick<vscode.ExtensionContext, \"asAbsolutePath\">): string;\n}\n\nasync function waitUntil(condition: () => boolean | Promise<boolean>, timeout = 5000, step = 50): Promise<void> {\n  const start = Date.now();\n  while (Date.now() - start <= timeout) {\n    if (await condition()) {\n      return;\n    }\n    await new Promise((resolve) => setTimeout(resolve, step));\n  }\n  throw new Error(\"Timed out waiting for condition\");\n}\n\nsuite(\"Vitte extension\", () => {\n  let extension: vscode.Extension<unknown> | undefined;\n  let api: ExtensionTestApi | undefined;\n\n  suiteSetup(async () => {\n    extension = vscode.extensions.getExtension(EXTENSION_ID);\n    assert.ok(extension, \"Extension introuvable dans le registre VS Code\");\n    await extension.activate();\n    assert.ok(extension.isActive, \"Extension non active après activation\");\n    api = extension.exports as ExtensionTestApi;\n  });\n\n  test(\"Extension s’active sans erreur\", () => {\n    assert.ok(extension, \"Extension non initialisée\");\n    assert.ok(extension.isActive, \"Extension non active après activation\");\n    assert.ok(api, \"API de test non exposée par l’extension\");\n  });\n\n  test(\"Les commandes principales sont déclarées\", async () => {\n    const commands = await vscode.commands.getCommands(true);\n    const expected = [\n      \"vitte.showServerLog\",\n      \"vitte.restartServer\",\n      \"vitte.runAction\",\n      \"vitte.quickActions\",\n      \"vitte.diagnostics.refresh\",\n    ];\n\n    for (const cmd of expected) {\n      assert.ok(commands.includes(cmd), `Commande ${cmd} non enregistrée`);\n    }\n  });\n\n  test(\"La commande restart redémarre le client\", async () => {\n    const testApi = api;\n    assert.ok(testApi, \"API de test non disponible\");\n    await vscode.commands.executeCommand(\"vitte.restartServer\");\n    await waitUntil(() => testApi.getStatusText().startsWith(\"$(check)\"), 8000);\n    const tooltip = testApi.getStatusTooltip().toLowerCase();\n    assert.ok(\n      tooltip.includes(\"opérationnel\") || tooltip.includes(\"running\"),\n      \"Le statut du client n’indique pas qu’il est démarré\"\n    );\n    assert.ok(\n      tooltip.includes(\"diagnostics\"),\n      \"Le statut ne mentionne pas la synthèse des diagnostics\"\n    );\n  });\n\n  test(\"La commande runAction déclenche l’action sélectionnée\", async () => {\n    const testApi = api;\n    assert.ok(testApi, \"API de test non disponible\");\n\n    const disposables: vscode.Disposable[] = [];\n    let formatCalled = false;\n\n    disposables.push(\n      vscode.commands.registerCommand(\"editor.action.formatDocument\", () => {\n        formatCalled = true;\n      })\n    );\n\n    const windowAny = vscode.window as unknown as { showQuickPick: (...args: unknown[]) => Thenable<unknown> };\n    const originalQuickPick = windowAny.showQuickPick;\n    windowAny.showQuickPick = () => Promise.resolve({\n      label: \"Format document\",\n      description: \"editor.action.formatDocument\",\n      action: \"format\",\n    });\n\n    const document = await vscode.workspace.openTextDocument({ content: \"test\", language: \"vitte\" });\n    await vscode.window.showTextDocument(document, { preview: false });\n\n    try {\n      await vscode.commands.executeCommand(\"vitte.runAction\");\n      await waitUntil(() => formatCalled, 1000, 20);\n    } finally {\n      windowAny.showQuickPick = originalQuickPick;\n      for (const disposable of disposables) {\n        disposable.dispose();\n      }\n      await vscode.commands.executeCommand(\"workbench.action.closeActiveEditor\");\n    }\n\n    assert.ok(formatCalled, \"La commande de formatage n’a pas été appelée\");\n  });\n\n  test(\"Une résolution sans serveur signale une erreur explicite\", () => {\n    const ext = extension;\n    assert.ok(ext, \"Extension non initialisée\");\n    const testApi = api;\n    assert.ok(testApi, \"API de test non disponible\");\n\n    const fakeRoot = path.join(\n      ext.extensionPath,\n      \".test-missing-server\",\n      Date.now().toString(36)\n    );\n    assert.ok(!fs.existsSync(fakeRoot), \"Le répertoire factice ne devrait pas exister\");\n    const fakeContext = {\n      asAbsolutePath: (relPath: string) => path.join(fakeRoot, relPath),\n    } as Pick<vscode.ExtensionContext, \"asAbsolutePath\">;\n\n    assert.throws(\n      () => testApi.resolveServerModuleForTest(fakeContext),\n      /Module serveur Vitte introuvable/\n    );\n  });\n\n  test(\"Quick Actions exécutent la séquence d’onboarding\", async () => {\n    const runOrder: string[] = [];\n    const tracked = new Set([\"vitte.openDocs\", \"vitte.detectToolchain\", \"vitte.build\"]);\n    const commandsAny = vscode.commands as unknown as {\n      executeCommand: (command: string, ...rest: unknown[]) => Thenable<unknown>;\n    };\n    const originalExecuteCommand = commandsAny.executeCommand.bind(vscode.commands);\n\n    commandsAny.executeCommand = (command: string, ...rest: unknown[]) => {\n      if (tracked.has(command)) {\n        runOrder.push(command);\n        return Promise.resolve(undefined);\n      }\n      return originalExecuteCommand(command, ...rest);\n    };\n\n    const windowAny = vscode.window as unknown as {\n      createQuickPick: (options?: vscode.QuickPickOptions) => vscode.QuickPick<vscode.QuickPickItem>;\n    };\n    const originalCreateQuickPick = windowAny.createQuickPick;\n    let createdQuickPick: QuickPickStub<vscode.QuickPickItem> | undefined;\n\n    windowAny.createQuickPick = () => {\n      createdQuickPick = new QuickPickStub<vscode.QuickPickItem>();\n      return createdQuickPick;\n    };\n\n    try {\n      const commandPromise = vscode.commands.executeCommand(\"vitte.quickActions\");\n      const quickPick = await waitFor(() => createdQuickPick, 1000);\n      const items = await quickPick.waitForItems(\n        (list) => list.some((item) => (item as QuickActionItemMetadata).actionId === \"onboarding.setup\"),\n      );\n      const target = items.find((item) => (item as QuickActionItemMetadata).actionId === \"onboarding.setup\");\n      assert.ok(target, \"Action onboarding.setup introuvable\");\n      quickPick.selectedItems = [target];\n      quickPick.fireAccept();\n      await commandPromise;\n\n      assert.deepEqual(\n        runOrder,\n        [\"vitte.openDocs\", \"vitte.detectToolchain\", \"vitte.build\"],\n        \"La séquence Run setup n’a pas déclenché tous les sous-commandes\"\n      );\n    } finally {\n      windowAny.createQuickPick = originalCreateQuickPick;\n      commandsAny.executeCommand = originalExecuteCommand;\n    }\n  });\n\n  test(\"Quick Actions respectent les séquences configurées\", async () => {\n    const cfg = vscode.workspace.getConfiguration(\"vitte\");\n    const customSequence = [\n      {\n        id: \"custom.buildTestBench\",\n        label: \"Build + Test + Bench\",\n        steps: [\n          { command: \"vitte.build\" },\n          { command: \"vitte.test\" },\n          { command: \"vitte.bench\" }\n        ]\n      }\n    ];\n    await cfg.update(\"quickActions.sequences\", customSequence, vscode.ConfigurationTarget.Global);\n\n    const runOrder: string[] = [];\n    const tracked = new Set<string>([\"vitte.build\", \"vitte.test\", \"vitte.bench\"]);\n    const commandsAny = vscode.commands as unknown as {\n      executeCommand: (command: string, ...rest: unknown[]) => Thenable<unknown>;\n    };\n    const originalExecuteCommand = commandsAny.executeCommand.bind(vscode.commands);\n    commandsAny.executeCommand = (command: string, ...rest: unknown[]) => {\n      if (tracked.has(command)) {\n        runOrder.push(command);\n        return Promise.resolve(undefined);\n      }\n      return originalExecuteCommand(command, ...rest);\n    };\n\n    const windowAny = vscode.window as unknown as {\n      createQuickPick: (options?: vscode.QuickPickOptions) => vscode.QuickPick<vscode.QuickPickItem>;\n    };\n    const originalCreateQuickPick = windowAny.createQuickPick;\n    let createdQuickPick: QuickPickStub<vscode.QuickPickItem> | undefined;\n    windowAny.createQuickPick = () => {\n      createdQuickPick = new QuickPickStub<vscode.QuickPickItem>();\n      return createdQuickPick;\n    };\n\n    try {\n      const commandPromise = vscode.commands.executeCommand(\"vitte.quickActions\");\n      const quickPick = await waitFor(() => createdQuickPick, 1000);\n      const items = await quickPick.waitForItems(\n        (list) => list.some((item) => (item as QuickActionItemMetadata).actionId === \"custom.buildTestBench\"),\n        2000\n      );\n      const target = items.find((item) => (item as QuickActionItemMetadata).actionId === \"custom.buildTestBench\");\n      assert.ok(target, \"Séquence personnalisée introuvable\");\n      quickPick.selectedItems = [target];\n      quickPick.fireAccept();\n      await commandPromise;\n\n      assert.deepEqual(\n        runOrder,\n        [\"vitte.build\", \"vitte.test\", \"vitte.bench\"],\n        \"La séquence personnalisée n’a pas exécuté toutes les commandes\"\n      );\n    } finally {\n      windowAny.createQuickPick = originalCreateQuickPick;\n      commandsAny.executeCommand = originalExecuteCommand;\n      await cfg.update(\"quickActions.sequences\", undefined, vscode.ConfigurationTarget.Global);\n    }\n  });\n\n  test(\"Quick Actions déclenchent bench et refresh diagnostics\", async () => {\n    const workspace = vscode.workspace.workspaceFolders?.[0];\n    if (!workspace) {\n      // Tests peuvent tourner sans workspace (ex: CI headless) — on passe dans ce cas.\n      return;\n    }\n    const benchConfigPath = path.join(workspace.uri.fsPath, \"vitte.config.json\");\n    fs.writeFileSync(benchConfigPath, \"{}\");\n\n    const tracked = new Set<string>([\"vitte.bench\", \"vitte.diagnostics.refresh\"]);\n    const runOrder: string[] = [];\n\n    const commandsAny = vscode.commands as unknown as {\n      executeCommand: (command: string, ...rest: unknown[]) => Thenable<unknown>;\n    };\n    const originalExecuteCommand = commandsAny.executeCommand.bind(vscode.commands);\n    commandsAny.executeCommand = (command: string, ...rest: unknown[]) => {\n      if (tracked.has(command)) {\n        runOrder.push(command);\n        return Promise.resolve(undefined);\n      }\n      return originalExecuteCommand(command, ...rest);\n    };\n\n    const windowAny = vscode.window as unknown as {\n      createQuickPick: (options?: vscode.QuickPickOptions) => vscode.QuickPick<vscode.QuickPickItem>;\n    };\n    const originalCreateQuickPick = windowAny.createQuickPick;\n    let createdQuickPick: QuickPickStub<vscode.QuickPickItem> | undefined;\n    windowAny.createQuickPick = () => {\n      createdQuickPick = new QuickPickStub<vscode.QuickPickItem>();\n      return createdQuickPick;\n    };\n\n    async function runQuickAction(actionId: string): Promise<void> {\n      const commandPromise = vscode.commands.executeCommand(\"vitte.quickActions\");\n      const quickPick = await waitFor(() => createdQuickPick, 1000);\n      const items = await quickPick.waitForItems(\n        (list) => list.some((item) => (item as QuickActionItemMetadata).actionId === actionId),\n        2000\n      );\n      const target = items.find((item) => (item as QuickActionItemMetadata).actionId === actionId);\n      assert.ok(target, `Action ${actionId} introuvable`);\n      quickPick.selectedItems = [target];\n      quickPick.fireAccept();\n      await commandPromise;\n      createdQuickPick = undefined;\n    }\n\n    try {\n      await runQuickAction(\"vitte.bench\");\n      await runQuickAction(\"vitte.diagnostics.refresh\");\n      assert.deepEqual(\n        runOrder,\n        [\"vitte.bench\", \"vitte.diagnostics.refresh\"],\n        \"Les actions bench/diagnostics n'ont pas été exécutées dans l'ordre attendu\"\n      );\n    } finally {\n      commandsAny.executeCommand = originalExecuteCommand;\n      windowAny.createQuickPick = originalCreateQuickPick;\n      if (fs.existsSync(benchConfigPath)) {\n        fs.unlinkSync(benchConfigPath);\n      }\n    }\n  });\n\n  test(\"Quick Actions toggles profile/incremental\", async () => {\n    const cfg = vscode.workspace.getConfiguration(\"vitte\");\n    const originalProfile = cfg.get<string>(\"build.profile\");\n    const originalIncremental = cfg.get<boolean>(\"build.incremental\");\n    await cfg.update(\"build.profile\", \"dev\", vscode.ConfigurationTarget.Global);\n    await cfg.update(\"build.incremental\", false, vscode.ConfigurationTarget.Global);\n\n    const commandsAny = vscode.commands as unknown as {\n      executeCommand: (command: string, ...rest: unknown[]) => Thenable<unknown>;\n    };\n    const originalExecuteCommand = commandsAny.executeCommand.bind(vscode.commands);\n    const tracked: string[] = [];\n    commandsAny.executeCommand = (command: string, ...rest: unknown[]) => {\n      if (command === \"vitte.switchProfile\" || command === \"vitte.toggleIncremental\") {\n        tracked.push(command);\n        return Promise.resolve(undefined);\n      }\n      return originalExecuteCommand(command, ...rest);\n    };\n\n    const windowAny = vscode.window as unknown as {\n      createQuickPick: (options?: vscode.QuickPickOptions) => vscode.QuickPick<vscode.QuickPickItem>;\n    };\n    const originalCreateQuickPick = windowAny.createQuickPick;\n    let activeQuickPick: QuickPickStub<vscode.QuickPickItem> | undefined;\n    windowAny.createQuickPick = () => {\n      activeQuickPick = new QuickPickStub<vscode.QuickPickItem>();\n      return activeQuickPick;\n    };\n\n    try {\n      const commandPromise = vscode.commands.executeCommand(\"vitte.quickActions\");\n      const quickPick = await waitFor(() => activeQuickPick, 1000);\n      const items = await quickPick.waitForItems();\n      const profileItem = items.find((item) => (item as QuickActionItemMetadata).label?.includes(\"Profile\"));\n      const incrementalItem = items.find((item) => (item as QuickActionItemMetadata).label?.includes(\"Incremental\"));\n      assert.ok(profileItem, \"Profile toggle not found\");\n      assert.ok(incrementalItem, \"Incremental toggle not found\");\n      quickPick.selectedItems = [profileItem];\n      quickPick.fireAccept();\n      await commandPromise;\n      const firstStub = activeQuickPick;\n      if (firstStub) {\n        firstStub.dispose();\n        activeQuickPick = undefined;\n      }\n      const secondRun = vscode.commands.executeCommand(\"vitte.quickActions\");\n      const quickPick2 = await waitFor(() => activeQuickPick, 1000);\n      quickPick2.selectedItems = [incrementalItem];\n      quickPick2.fireAccept();\n      await secondRun;\n      const secondStub = activeQuickPick;\n      if (secondStub) {\n        secondStub.dispose();\n        activeQuickPick = undefined;\n      }\n\n      assert.deepEqual(\n        tracked,\n        [\"vitte.switchProfile\", \"vitte.toggleIncremental\"],\n        \"Toggles were not executed in order\"\n      );\n    } finally {\n      windowAny.createQuickPick = originalCreateQuickPick;\n      commandsAny.executeCommand = originalExecuteCommand;\n      await cfg.update(\"build.profile\", originalProfile, vscode.ConfigurationTarget.Global);\n      await cfg.update(\"build.incremental\", originalIncremental, vscode.ConfigurationTarget.Global);\n    }\n  });\n\n  test(\"Quick Actions trigger Next Diagnostic\", async () => {\n    const commandsAny = vscode.commands as unknown as {\n      executeCommand: (command: string, ...rest: unknown[]) => Thenable<unknown>;\n    };\n    const originalExecuteCommand = commandsAny.executeCommand.bind(vscode.commands);\n    let markerCalled = false;\n    commandsAny.executeCommand = (command: string, ...rest: unknown[]) => {\n      if (command === \"editor.action.marker.next\") {\n        markerCalled = true;\n        return Promise.resolve(undefined);\n      }\n      return originalExecuteCommand(command, ...rest);\n    };\n\n    const windowAny = vscode.window as unknown as {\n      createQuickPick: (options?: vscode.QuickPickOptions) => vscode.QuickPick<vscode.QuickPickItem>;\n    };\n    const originalCreateQuickPick = windowAny.createQuickPick;\n    let activeQuickPick: QuickPickStub<vscode.QuickPickItem> | undefined;\n    windowAny.createQuickPick = () => {\n      activeQuickPick = new QuickPickStub<vscode.QuickPickItem>();\n      return activeQuickPick;\n    };\n\n    try {\n      const commandPromise = vscode.commands.executeCommand(\"vitte.quickActions\");\n      const quickPick = await waitFor(() => activeQuickPick, 1000);\n      const items = await quickPick.waitForItems();\n      const diagItem = items.find((item) => (item as QuickActionItemMetadata).label?.includes(\"Next issue\"));\n      assert.ok(diagItem, \"Next issue action not found\");\n      quickPick.selectedItems = [diagItem];\n      quickPick.fireAccept();\n      await commandPromise;\n      const diagStub = activeQuickPick;\n      if (diagStub) {\n        diagStub.dispose();\n        activeQuickPick = undefined;\n      }\n      assert.ok(markerCalled, \"Diagnostics navigation command was not executed\");\n    } finally {\n      commandsAny.executeCommand = originalExecuteCommand;\n      windowAny.createQuickPick = originalCreateQuickPick;\n    }\n  });\n});\n\ninterface QuickActionItemMetadata extends vscode.QuickPickItem {\n  readonly actionId?: string;\n}\n\nasync function waitFor<T>(\n  resolver: () => T | undefined,\n  timeout = 1000,\n  step = 10\n): Promise<T> {\n  const start = Date.now();\n  while (Date.now() - start < timeout) {\n    const value = resolver();\n    if (value !== undefined) return value;\n    await new Promise((resolve) => setTimeout(resolve, step));\n  }\n  throw new Error(\"Timed out waiting for value\");\n}\n\nclass QuickPickStub<T extends vscode.QuickPickItem> implements vscode.QuickPick<T> {\n  private readonly acceptEmitter = new vscode.EventEmitter<void>();\n  private readonly hideEmitter = new vscode.EventEmitter<void>();\n  private readonly selectionEmitter = new vscode.EventEmitter<readonly T[]>();\n  private readonly valueEmitter = new vscode.EventEmitter<string>();\n  private readonly activeEmitter = new vscode.EventEmitter<readonly T[]>();\n  private readonly buttonEmitter = new vscode.EventEmitter<vscode.QuickInputButton>();\n  private readonly itemButtonEmitter = new vscode.EventEmitter<vscode.QuickPickItemButtonEvent<T>>();\n  private readonly itemsEmitter = new vscode.EventEmitter<readonly T[]>();\n\n  private _items: readonly T[] = [];\n  private _selectedItems: readonly T[] = [];\n  private _buttons: readonly vscode.QuickInputButton[] = [];\n  private _activeItems: readonly T[] = [];\n\n  public title: string | undefined;\n  public step: number | undefined;\n  public totalSteps: number | undefined;\n  public enabled = true;\n  public busy = false;\n  public ignoreFocusOut = true;\n  public canSelectMany = false;\n  public matchOnDescription = true;\n  public matchOnDetail = false;\n  public keepScrollPosition = false;\n  public placeholder: string | undefined;\n  public value = \"\";\n  public sortByLabel = true;\n\n  public get items(): readonly T[] {\n    return this._items;\n  }\n  public set items(value: readonly T[]) {\n    this._items = value;\n    this.itemsEmitter.fire(value);\n  }\n\n  public get buttons(): readonly vscode.QuickInputButton[] {\n    return this._buttons;\n  }\n  public set buttons(value: readonly vscode.QuickInputButton[]) {\n    this._buttons = value;\n  }\n\n  public get selectedItems(): readonly T[] {\n    return this._selectedItems;\n  }\n  public set selectedItems(value: readonly T[]) {\n    this._selectedItems = value;\n    this.selectionEmitter.fire(value);\n  }\n\n  public get activeItems(): readonly T[] {\n    return this._activeItems;\n  }\n  public set activeItems(value: readonly T[]) {\n    this._activeItems = value;\n    this.activeEmitter.fire(value);\n  }\n\n  public onDidAccept = this.acceptEmitter.event;\n  public onDidHide = this.hideEmitter.event;\n  public onDidChangeSelection = this.selectionEmitter.event;\n  public onDidChangeValue = this.valueEmitter.event;\n  public onDidChangeActive = this.activeEmitter.event;\n  public onDidTriggerButton = this.buttonEmitter.event;\n  public onDidTriggerItemButton = this.itemButtonEmitter.event;\n\n  show(): void {\n    /* no-op */\n  }\n\n  hide(): void {\n    this.hideEmitter.fire();\n  }\n\n  dispose(): void {\n    this.acceptEmitter.dispose();\n    this.hideEmitter.dispose();\n    this.selectionEmitter.dispose();\n    this.valueEmitter.dispose();\n    this.activeEmitter.dispose();\n    this.buttonEmitter.dispose();\n    this.itemButtonEmitter.dispose();\n    this.itemsEmitter.dispose();\n  }\n\n  fireAccept(): void {\n    this.acceptEmitter.fire();\n  }\n\n  waitForItems(predicate?: (items: readonly T[]) => boolean, timeout = 2000): Promise<readonly T[]> {\n    const check = predicate ?? ((list: readonly T[]) => list.length > 0);\n    if (check(this._items)) {\n      return Promise.resolve(this._items);\n    }\n    return new Promise((resolve, reject) => {\n      const disposable = this.itemsEmitter.event((value) => {\n        if (check(value)) {\n          disposable.dispose();\n          clearTimeout(timer);\n          resolve(value);\n        }\n      });\n      const timer = setTimeout(() => {\n        disposable.dispose();\n        reject(new Error(\"QuickPick items not populated in time\"));\n      }, timeout);\n    });\n  }\n\n}\n"]}